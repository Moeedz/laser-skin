{% comment %}
  5x8 Facial Treatment Bundle - Grid Card Design
  - Card-based grid layout with 5 treatments per category
  - Navigate between category selection and treatment options
  - All 200 treatments embedded
{% endcomment %}

<div class="facial-bundle-grid" data-section-id="{{ section.id }}">
  <div class="bundle-container">
    {% if section.settings.section_title != blank %}
      <h2 class="bundle-title">{{ section.settings.section_title }}</h2>
    {% endif %}
    
    {% if section.settings.section_description != blank %}
      <div class="bundle-description">{{ section.settings.section_description }}</div>
    {% endif %}

    <!-- Skin Goal Selector -->
    <div class="skin-type-selector">
      <h3 class="selector-title">Select Your Skin Goal</h3>
      <div class="skin-type-options">
        <button type="button" class="skin-type-btn" data-skin-type="Glow">Glow</button>
        <button type="button" class="skin-type-btn" data-skin-type="Hydrate">Hydrate</button>
        <button type="button" class="skin-type-btn" data-skin-type="Calm">Calm</button>
        <button type="button" class="skin-type-btn" data-skin-type="Lift">Lift</button>
        <button type="button" class="skin-type-btn" data-skin-type="Clarify">Clarify</button>
      </div>
    </div>

    <!-- Bundle Progress Bar (Sticky) -->
    <div class="bundle-progress" id="bundleProgress" style="display: none;">
      <div class="progress-info">
        <span class="progress-label">Facial Progress:</span>
        <span class="progress-count" id="progressCount">0 / 8 treatments selected</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <!-- Category Grid -->
    <div class="category-grid" id="categoryGrid" style="display: none;">
      
      <!-- Category Card 1: Cleanse & Prep -->
      <div class="category-card" data-category="Cleanse & Prep">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="32" cy="20" r="8" stroke="currentColor" stroke-width="3"/>
            <path d="M25 28c-4 2-7 6-7 10v8h28v-8c0-4-3-8-7-10" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <path d="M28 38h8M28 42h8" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="category-number">1</div>
        <h4 class="category-name">CLEANSE &<br>PREP</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

      <!-- Category Card 2: Exfoliate & Refine -->
      <div class="category-card" data-category="Exfoliate & Refine">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="32" cy="32" r="18" stroke="currentColor" stroke-width="3"/>
            <circle cx="24" cy="24" r="2" fill="currentColor"/>
            <circle cx="40" cy="24" r="2" fill="currentColor"/>
            <circle cx="24" cy="40" r="2" fill="currentColor"/>
            <circle cx="40" cy="40" r="2" fill="currentColor"/>
            <circle cx="32" cy="32" r="2" fill="currentColor"/>
            <circle cx="32" cy="20" r="2" fill="currentColor"/>
            <circle cx="32" cy="44" r="2" fill="currentColor"/>
            <circle cx="20" cy="32" r="2" fill="currentColor"/>
            <circle cx="44" cy="32" r="2" fill="currentColor"/>
          </svg>
        </div>
        <div class="category-number">2</div>
        <h4 class="category-name">EXFOLIATE &<br>REFINE</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

      <!-- Category Card 3: Detox & Refresh -->
      <div class="category-card" data-category="Detox & Refresh">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M32 12v8M32 44v8M12 32h8M44 32h8" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <circle cx="32" cy="32" r="12" stroke="currentColor" stroke-width="3"/>
            <path d="M26 32c0-2 1-4 3-5 2-1 4-1 6 0 2 1 3 3 3 5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="category-number">3</div>
        <h4 class="category-name">DETOX &<br>REFRESH</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

      <!-- Category Card 4: Hydro Infusions -->
      <div class="category-card" data-category="Hydro Infusions">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M32 10c-2 4-4 8-4 12 0 4 2 8 4 8s4-4 4-8c0-4-2-8-4-12z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
            <path d="M22 36c-2 3-3 6-3 9 0 7 6 13 13 13s13-6 13-13c0-3-1-6-3-9" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <path d="M28 46c0-2 2-4 4-4s4 2 4 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="category-number">4</div>
        <h4 class="category-name">HYDRO<br>INFUSIONS</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

      <!-- Category Card 5: Mask Bar -->
      <div class="category-card" data-category="Mask Bar">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <ellipse cx="32" cy="32" rx="20" ry="16" stroke="currentColor" stroke-width="3"/>
            <path d="M16 28c2-6 8-10 16-10s14 4 16 10" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
            <circle cx="24" cy="30" r="2.5" fill="currentColor"/>
            <circle cx="40" cy="30" r="2.5" fill="currentColor"/>
            <path d="M26 38c2 2 4 3 6 3s4-1 6-3" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="category-number">5</div>
        <h4 class="category-name">MASK<br>BAR</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

      <!-- Category Card 6: Technology Lounge -->
      <div class="category-card" data-category="Technology Lounge">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="14" y="18" width="36" height="28" rx="3" stroke="currentColor" stroke-width="3"/>
            <path d="M22 28h20M22 34h20M22 40h12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
            <circle cx="42" cy="40" r="3" stroke="currentColor" stroke-width="2"/>
            <path d="M18 12l4 6M46 12l-4 6" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="category-number">6</div>
        <h4 class="category-name">TECHNOLOGY<br>LOUNGE</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

      <!-- Category Card 7: Boosters & Infusions -->
      <div class="category-card" data-category="Boosters & Infusions">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="32" cy="18" r="4" fill="currentColor"/>
            <circle cx="20" cy="28" r="3" fill="currentColor"/>
            <circle cx="44" cy="28" r="3" fill="currentColor"/>
            <circle cx="26" cy="40" r="3.5" fill="currentColor"/>
            <circle cx="38" cy="40" r="3.5" fill="currentColor"/>
            <circle cx="32" cy="50" r="4.5" fill="currentColor"/>
            <path d="M32 22v6M24 30l4 4M40 30l-4 4M28 44l2 3M36 44l-2 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="category-number">7</div>
        <h4 class="category-name">BOOSTERS &<br>INFUSIONS</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

      <!-- Category Card 8: Finish & Protect -->
      <div class="category-card" data-category="Finish & Protect">
        <div class="category-icon">
          <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M32 10l-16 6v12c0 10 6 18 16 22 10-4 16-12 16-22V16z" stroke="currentColor" stroke-width="3" stroke-linejoin="round"/>
            <path d="M26 30l4 4 8-8" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="category-number">8</div>
        <h4 class="category-name">FINISH &<br>PROTECT</h4>
        <div class="category-checkmark">‚úì</div>
      </div>

    </div>

    <!-- Treatment Selection Panel (Hidden initially) -->
    <div class="treatment-panel" id="treatmentPanel" style="display: none;">
      <button type="button" class="back-btn" id="backBtn">‚Üê Back to Categories</button>
      <h3 class="treatment-panel-title" id="treatmentPanelTitle"></h3>
      <div class="treatment-list" id="treatmentList"></div>
    </div>

    <!-- Appointment Picker -->
    <div class="appointment-section" id="appointmentSection" style="display: none;">
      <h3 class="appointment-title">Select Your Appointment Date & Time</h3>
      <div class="appointment-dropdown" id="appointmentDropdown">
        <span id="appointmentDisplay">Choose appointment date and time</span>
        <span class="appointment-dropdown-icon">‚ñº</span>
      </div>

      <!-- Appointment Modal -->
      <div class="appointment-modal" id="appointmentModal">
        <div class="appointment-modal-content">
          <div class="appointment-modal-header">
            <div class="appointment-modal-title">üìÖ Select Date and Time</div>
            <button type="button" class="appointment-modal-close" id="closeModal">&times;</button>
          </div>
          <div class="appointment-modal-body">
            <div class="calendar-header">
              <button type="button" class="calendar-nav-btn" id="prevMonth">‚Äπ</button>
              <div class="calendar-month-year" id="monthYear"></div>
              <button type="button" class="calendar-nav-btn" id="nextMonth">‚Ä∫</button>
            </div>
            <div class="calendar-weekdays">
              <div class="calendar-weekday">Mon</div>
              <div class="calendar-weekday">Tue</div>
              <div class="calendar-weekday">Wed</div>
              <div class="calendar-weekday">Thu</div>
              <div class="calendar-weekday">Fri</div>
              <div class="calendar-weekday">Sat</div>
              <div class="calendar-weekday">Sun</div>
            </div>
            <div class="calendar-dates" id="calendarDates"></div>
            <div class="time-panel-header" id="timeHeader">Select a date first</div>
            <div class="time-slots-scroll" id="timeSlots"></div>
          </div>
          <div class="appointment-modal-footer">
            <button type="button" class="appointment-btn appointment-btn-cancel" id="cancelBtn">Cancel</button>
            <button type="button" class="appointment-btn appointment-btn-confirm" id="confirmBtn" disabled>Confirm</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bundle Footer -->
    <div class="bundle-footer" id="bundleFooter" style="display: none;">
      <div class="bundle-pricing">
        <div class="price-display">
          <span class="price-label">Total Price:</span>
          <span class="price-amount">¬£99</span>
        </div>
        <div class="selections-info" id="selectionsInfo">Choose appointment date and time to proceed</div>
      </div>

      <button 
        type="button" 
        class="bundle-add-to-cart"
        id="addToCartBtn"
        disabled
      >
        Book Facial Now
      </button>
    </div>
  </div>
</div>

<style>
/* 
  STICKY PROGRESS BAR SETUP:
  If the progress bar overlaps your header, adjust these values:
  - Desktop: Change "top: 80px" to your header height + 10px
  - Mobile: Change "top: 60px" to your mobile header height + 10px
*/

.facial-bundle-grid {
  max-width: 1200px;
  margin: 0 auto;
  padding: 40px 20px;
}

.bundle-container {
  background: #fff;
  border-radius: 12px;
  padding: 40px;
}

.bundle-title {
  font-size: 36px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 15px;
  color: #1a1a1a;
}

.bundle-description {
  text-align: center;
  color: #666;
  margin-bottom: 40px;
  font-size: 16px;
  line-height: 1.6;
}

/* Skin Goal Selector */
.skin-type-selector {
  margin-bottom: 40px;
  text-align: center;
}

.selector-title {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 25px;
  color: #1a1a1a;
}

.skin-type-options {
  display: flex;
  gap: 12px;
  justify-content: center;
  flex-wrap: wrap;
}

.skin-type-btn {
  padding: 14px 28px;
  background: white;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #333;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 140px;
}

.skin-type-btn:hover {
  border-color: #4CAF50;
  background: #f0f9f0;
  transform: translateY(-2px);
}

.skin-type-btn.active {
  background: #4CAF50;
  color: white;
  border-color: #4CAF50;
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

/* Progress Bar (Sticky) */
.bundle-progress {
  margin-bottom: 35px;
  padding: 25px;
  background: #ffffff;
  border-radius: 0px;
  position: sticky;
  top: 123px;
  z-index: 3;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  border: 2px solid #e0e0e0;
}

.bundle-progress.scrolled {
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  background: #f8fef8;
  border-color: #4CAF50;
}

.progress-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.progress-label {
  font-size: 16px;
  font-weight: 600;
  color: #333;
}

.progress-count {
  font-size: 14px;
  color: #666;
  font-weight: 500;
}

.progress-bar {
  width: 100%;
  height: 12px;
  background: #e0e0e0;
  border-radius: 10px;
  overflow: visible;
  position: relative;
  display: block;
}

.progress-fill {
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%);
  width: 0%;
  transition: width 0.4s ease;
  border-radius: 10px;
  display: block;
  will-change: width;
}

/* Category Grid */
.category-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.category-card {
  position: relative;
  background: rgba(255, 255, 255, 0.8);
  border: 3px solid #e0e0e0;
  border-radius: 16px;
  padding: 30px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  min-height: 220px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(10px);
}

.category-card:hover {
  border-color: #4CAF50;
  background: rgba(248, 255, 248, 0.95);
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(76, 175, 80, 0.2);
}

.category-card.completed {
  border-color: #4CAF50;
  background: rgba(232, 245, 233, 0.95);
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15);
}

.category-icon {
  width: 80px;
  height: 80px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.category-icon svg {
  width: 48px;
  height: 48px;
  color: #4CAF50;
}

.category-number {
  position: absolute;
  top: 15px;
  left: 15px;
  width: 32px;
  height: 32px;
  background: #4CAF50;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  font-weight: 700;
}

.category-name {
  font-size: 14px;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0;
  line-height: 1.3;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.category-checkmark {
  position: absolute;
  top: 15px;
  right: 15px;
  width: 32px;
  height: 32px;
  background: #4CAF50;
  color: white;
  border-radius: 50%;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  font-weight: 700;
}

.category-card.completed .category-checkmark {
  display: flex;
}

/* Treatment Selection Panel */
.treatment-panel {
  margin-bottom: 30px;
}

.back-btn {
  background: #f5f5f5;
  border: 2px solid #e0e0e0;
  padding: 12px 24px;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  color: #333;
  cursor: pointer;
  margin-bottom: 20px;
  transition: all 0.2s;
}

.back-btn:hover {
  background: #e0e0e0;
  border-color: #999;
}

.treatment-panel-title {
  font-size: 28px;
  font-weight: 700;
  color: #1a1a1a;
  margin-bottom: 25px;
  text-align: center;
}

.treatment-list {
  display: grid;
  gap: 12px;
}

.treatment-item {
  background: #f8f8f8;
  border: 2px solid transparent;
  border-radius: 10px;
  padding: 18px 20px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: flex-start;
  gap: 15px;
}

.treatment-item:hover {
  background: #f0f9f0;
  border-color: #4CAF50;
  transform: translateX(4px);
}

.treatment-item.selected {
  background: #e8f5e9;
  border-color: #4CAF50;
}

.treatment-radio {
  width: 22px;
  height: 22px;
  border: 2px solid #D1D5DB;
  border-radius: 50%;
  position: relative;
  flex-shrink: 0;
  margin-top: 2px;
  transition: all 0.2s;
}

.treatment-item.selected .treatment-radio {
  border-color: #4CAF50;
}

.treatment-item.selected .treatment-radio::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 12px;
  height: 12px;
  background: #4CAF50;
  border-radius: 50%;
}

.treatment-content {
  flex: 1;
}

.treatment-name {
  font-size: 16px;
  font-weight: 600;
  color: #333;
  margin-bottom: 6px;
  display: block;
}

.treatment-item.selected .treatment-name {
  color: #4CAF50;
}

.treatment-description {
  font-size: 14px;
  color: #666;
  line-height: 1.5;
  margin: 0;
}

/* Appointment Section */
.appointment-section {
  margin-bottom: 30px;
  padding: 30px;
  background: #f8f8f8;
  border-radius: 12px;
}

.appointment-title {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 20px;
  color: #1a1a1a;
  text-align: center;
}

.appointment-dropdown {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  background: white;
  font-size: 16px;
  color: #333;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
  transition: all 0.2s;
}

.appointment-dropdown:hover {
  border-color: #4CAF50;
  background: #f9fff9;
}

.appointment-dropdown-icon {
  transition: transform 0.3s;
  color: #666;
}

.appointment-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 9999;
  align-items: center;
  justify-content: center;
}

.appointment-modal.active {
  display: flex;
}

.appointment-modal-content {
  background: white;
  border-radius: 12px;
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.appointment-modal-header {
  padding: 20px 25px;
  border-bottom: 2px solid #eee;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #f8f8f8;
}

.appointment-modal-title {
  font-size: 20px;
  font-weight: 600;
  color: #1a1a1a;
}

.appointment-modal-close {
  background: none;
  border: none;
  font-size: 28px;
  color: #999;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  line-height: 1;
  transition: color 0.2s;
}

.appointment-modal-close:hover {
  color: #333;
}

.appointment-modal-body {
  padding: 25px;
}

.calendar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.calendar-nav-btn {
  background: #f5f5f5;
  border: 1px solid #e0e0e0;
  cursor: pointer;
  padding: 8px 14px;
  font-size: 22px;
  border-radius: 6px;
  min-width: 44px;
  transition: all 0.2s;
}

.calendar-nav-btn:hover {
  background: #4CAF50;
  color: white;
  border-color: #4CAF50;
}

.calendar-month-year {
  font-size: 18px;
  font-weight: 700;
  color: #1a1a1a;
}

.calendar-weekdays {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  margin-bottom: 10px;
}

.calendar-weekday {
  text-align: center;
  font-size: 13px;
  font-weight: 600;
  color: #666;
  padding: 8px 0;
}

.calendar-dates {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  margin-bottom: 25px;
}

.calendar-date {
  aspect-ratio: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  font-weight: 500;
  cursor: pointer;
  border-radius: 50%;
  transition: all 0.2s;
  border: 2px solid transparent;
  min-height: 42px;
}

.calendar-date:hover:not(.disabled):not(.past) {
  background: #f0f9f0;
  border-color: #4CAF50;
}

.calendar-date.selected {
  background: #4CAF50;
  color: white;
  transform: scale(1.05);
}

.calendar-date.today {
  border-color: #4CAF50;
  font-weight: 700;
}

.calendar-date.disabled {
  color: #ccc;
  cursor: not-allowed;
  text-decoration: line-through;
}

.calendar-date.past {
  color: #ddd;
  cursor: not-allowed;
}

.time-panel-header {
  background: #4CAF50;
  color: white;
  padding: 14px 18px;
  text-align: center;
  font-size: 15px;
  font-weight: 600;
  border-radius: 8px 8px 0 0;
}

.time-slots-scroll {
  border: 2px solid #e0e0e0;
  border-top: none;
  border-radius: 0 0 8px 8px;
  max-height: 280px;
  overflow-y: auto;
  padding: 10px;
  background: #fafafa;
}

.time-slot-option {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px;
  margin-bottom: 6px;
  cursor: pointer;
  border-radius: 6px;
  background: white;
  border: 2px solid transparent;
  transition: all 0.2s;
}

.time-slot-option:hover {
  background: #f0f9f0;
  border-color: #4CAF50;
}

.time-slot-option.selected {
  background: #e8f5e9;
  border-color: #4CAF50;
}

.time-slot-radio {
  width: 22px;
  height: 22px;
  border: 2px solid #D1D5DB;
  border-radius: 50%;
  position: relative;
  transition: all 0.2s;
}

.time-slot-option.selected .time-slot-radio {
  border-color: #4CAF50;
}

.time-slot-option.selected .time-slot-radio::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 12px;
  height: 12px;
  background: #4CAF50;
  border-radius: 50%;
}

.appointment-modal-footer {
  padding: 20px 25px;
  border-top: 2px solid #eee;
  display: flex;
  gap: 12px;
  background: #f8f8f8;
  position: sticky;
  bottom: 0;
  z-index: 10;
}

.appointment-btn {
  flex: 1;
  padding: 14px 28px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}

.appointment-btn-cancel {
  background: white;
  color: #666;
  border: 2px solid #e0e0e0;
}

.appointment-btn-cancel:hover {
  background: #f5f5f5;
  border-color: #999;
}

.appointment-btn-confirm {
  background: #4CAF50;
  color: white;
}

.appointment-btn-confirm:hover:not(:disabled) {
  background: #45a049;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
}

.appointment-btn-confirm:disabled {
  background: #ccc;
  cursor: not-allowed;
  opacity: 0.6;
}

/* Bundle Footer */
.bundle-footer {
  background: #f8f8f8;
  padding: 30px;
  border-radius: 12px;
  margin-top: 30px;
}

.bundle-pricing {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.price-display {
  display: flex;
  align-items: center;
  gap: 12px;
}

.price-label {
  font-size: 18px;
  color: #666;
  font-weight: 500;
}

.price-amount {
  font-size: 36px;
  font-weight: 700;
  color: #4CAF50;
}

.selections-info {
  font-size: 14px;
  color: #666;
  font-weight: 500;
}

.bundle-add-to-cart {
  width: 100%;
  padding: 18px 32px;
  font-size: 18px;
  font-weight: 600;
  background: #4CAF50;
  color: white;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.bundle-add-to-cart:hover:not(:disabled) {
  background: #45a049;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(76, 175, 80, 0.3);
}

.bundle-add-to-cart:disabled {
  background: #ccc;
  cursor: not-allowed;
  opacity: 0.6;
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .facial-bundle-grid {
    padding: 20px 15px;
  }

  .bundle-container {
    padding: 25px 20px;
  }

  .bundle-title {
    font-size: 28px;
  }

  .selector-title {
    font-size: 20px;
  }

  .skin-type-options {
    gap: 10px;
  }

  .skin-type-btn {
    padding: 12px 20px;
    font-size: 14px;
    min-width: 120px;
  }

  .bundle-progress {
    padding: 15px;
    margin-bottom: 20px;
    top: 60px;
    border-radius: 0 0 8px 8px;
    font-size: 14px;
  }
  
  .progress-info {
    flex-direction: column;
    gap: 6px;
    align-items: flex-start;
  }
  
  .progress-label {
    font-size: 14px;
  }
  
  .progress-count {
    font-size: 13px;
  }
  
  .progress-bar {
    height: 10px;
  }

  .category-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }

  .category-card {
    min-height: 180px;
    padding: 20px 15px;
  }

  .category-icon {
    width: 60px;
    height: 60px;
    margin-bottom: 10px;
  }

  .category-icon svg {
    width: 36px;
    height: 36px;
  }

  .category-number {
    width: 28px;
    height: 28px;
    font-size: 14px;
    top: 10px;
    left: 10px;
  }

  .category-name {
    font-size: 12px;
  }

  .category-checkmark {
    width: 28px;
    height: 28px;
    font-size: 16px;
    top: 10px;
    right: 10px;
  }

  .treatment-panel-title {
    font-size: 22px;
  }

  .treatment-item {
    padding: 14px 16px;
  }

  .treatment-name {
    font-size: 14px;
  }

  .treatment-description {
    font-size: 13px;
  }

  .appointment-section {
    padding: 20px;
  }

  .appointment-title {
    font-size: 20px;
  }

  .appointment-dropdown {
    padding: 14px 16px;
    font-size: 14px;
  }

  .bundle-pricing {
    flex-direction: column;
    gap: 15px;
    align-items: flex-start;
  }

  .price-amount {
    font-size: 30px;
  }

  .bundle-add-to-cart {
    font-size: 16px;
    padding: 16px 24px;
  }

  .bundle-footer {
    padding: 20px;
  }
}

@media (max-width: 480px) {
  .bundle-title {
    font-size: 24px;
  }

  .skin-type-options {
    flex-direction: column;
  }

  .skin-type-btn {
    width: 100%;
  }

  .price-amount {
    font-size: 26px;
  }
  
  .bundle-progress {
    top: 89px;
    padding: 12px;
  }

  .category-grid {
    gap: 12px;
  }

  .category-card {
    min-height: 160px;
  }

  .category-icon {
    width: 50px;
    height: 50px;
  }

  .category-icon svg {
    width: 30px;
    height: 30px;
  }
}
</style>

<script>
// All treatment data embedded
const TREATMENT_DATA = {
  "Glow": {
    "Cleanse & Prep": [
      {
        "name": "Botanical Cream Cleanse",
        "description": "A silky cleanse that melts away impurities while leaving skin balanced, comfortable and naturally radiant."
      },
      {
        "name": "Oxygen Foaming Cleanse",
        "description": "A light, airy cleanse that wakes up the skin and leaves it feeling clean, energised and refreshed."
      },
      {
        "name": "Enzyme Powder Cleanse",
        "description": "An activating enzyme cleanse that lightly smooths the skin for a fresh, healthy glow."
      },
      {
        "name": "Charcoal Detox Cleanse",
        "description": "A detoxifying cleanse that clears surface impurities while keeping the skin balanced and bright."
      },
      {
        "name": "Hot Iron Skin Prep",
        "description": "A warming prep step that softens the skin and opens the door for deeper, more effective treatment results."
      }
    ],
    "Exfoliate & Refine": [
      {
        "name": "Enzyme Resurfacing",
        "description": "A gentle resurfacing step that smooths texture and keeps skin looking fresh, clear and radiant."
      },
      {
        "name": "Lactic Glow Peel",
        "description": "A glow-enhancing exfoliation that softens the skin and boosts natural luminosity."
      },
      {
        "name": "Mandelic Acid Peel",
        "description": "A refining peel that improves clarity and smoothness while keeping skin comfortable."
      },
      {
        "name": "Pumpkin Enzyme Treatment",
        "description": "A warming exfoliation that refreshes the skin and restores a healthy glow."
      },
      {
        "name": "Glycolic Micro-Peel",
        "description": "A light resurfacing peel that brightens dull skin and enhances smoothness."
      }
    ],
    "Detox & Refresh": [
      {
        "name": "Hydro Extraction",
        "description": "A refreshing pore cleanse that lifts congestion while keeping the skin hydrated and balanced."
      },
      {
        "name": "Manual Extractions",
        "description": "Targeted congestion clearing to refine texture and leave skin feeling clean and smooth."
      },
      {
        "name": "Oxygenating Mask",
        "description": "An energising mask that refreshes the skin and restores a healthy glow."
      },
      {
        "name": "Charcoal Detox Mask",
        "description": "A detoxifying mask that draws out impurities and leaves pores feeling fresh."
      },
      {
        "name": "Lymphatic Drainage Massage",
        "description": "A soothing massage that reduces puffiness and enhances natural radiance."
      }
    ],
    "Hydro Infusions": [
      {
        "name": "Skin Renewal Infusion",
        "description": "A revitalising infusion that refreshes the skin and restores a healthy, natural glow."
      },
      {
        "name": "Deep Hydration Infusion",
        "description": "A replenishing hydration hit that leaves skin soft, plump and refreshed."
      },
      {
        "name": "Antioxidant Infusion",
        "description": "A protective infusion that shields the skin from everyday stress while enhancing radiance."
      },
      {
        "name": "Glow-Enhancing Infusion",
        "description": "A radiance-boosting infusion that leaves the complexion bright and healthy-looking."
      },
      {
        "name": "Plumping Infusion",
        "description": "A hydration-rich treatment that visibly plumps the skin and softens fine lines."
      }
    ],
    "Mask Bar": [
      {
        "name": "Collagen Fleece Mask",
        "description": "A skin-plumping collagen veil that restores bounce, smoothness and glow."
      },
      {
        "name": "Jelly Hydration Mask",
        "description": "A cooling jelly mask that floods the skin with hydration and luminosity."
      },
      {
        "name": "Anti-Age Renewal Mask",
        "description": "A rejuvenating mask designed to support firmness and smooth fine lines."
      },
      {
        "name": "Algae Oxygen Mask",
        "description": "An oxygenating algae mask that revitalises dull skin and boosts radiance."
      },
      {
        "name": "Cream Comfort Mask",
        "description": "A nourishing cream mask that smooths and comforts the skin."
      }
    ],
    "Technology Lounge": [
      {
        "name": "LED Light Therapy",
        "description": "A restorative light treatment that supports skin health and enhances natural radiance."
      },
      {
        "name": "Microcurrent Facial Lift",
        "description": "A toning facial workout that lifts and contours for a refreshed appearance."
      },
      {
        "name": "Radiofrequency Skin Tightening",
        "description": "A warming treatment that firms the skin and smooths facial contours."
      },
      {
        "name": "Ultrasound Infusion",
        "description": "A technology step that enhances ingredient absorption for longer-lasting results."
      },
      {
        "name": "Oxygen Infusion Therapy",
        "description": "A revitalising treatment that boosts luminosity and leaves skin refreshed."
      }
    ],
    "Boosters & Infusions": [
      {
        "name": "Hyaluronic Hydration Boost",
        "description": "A burst of hydration that plumps the skin and keeps it looking fresh and luminous."
      },
      {
        "name": "Vitamin C Glow Boost",
        "description": "A radiance-boosting infusion that enhances glow and evens skin tone."
      },
      {
        "name": "Peptide Firming Boost",
        "description": "A skin-smoothing boost that supports firmness and elasticity."
      },
      {
        "name": "Growth Factor Renewal Boost",
        "description": "An advanced boost designed to support renewal and long-term skin health."
      },
      {
        "name": "Niacinamide Balance Boost",
        "description": "A refining boost that smooths texture and promotes an even complexion."
      }
    ],
    "Finish & Protect": [
      {
        "name": "Barrier Seal + SPF",
        "description": "A protective finishing step that seals in treatment results while shielding the skin from daily environmental stress."
      },
      {
        "name": "Antioxidant Mist",
        "description": "A refreshing mist that hydrates, protects and boosts luminosity."
      },
      {
        "name": "Glow Serum",
        "description": "A lightweight serum that enhances brightness and smooths the skin."
      },
      {
        "name": "Hydrating Moisturiser",
        "description": "A balanced moisturiser that keeps skin soft, smooth and comfortable."
      },
      {
        "name": "Eye & Lip Finish",
        "description": "A targeted finishing touch to refresh and smooth delicate areas."
      }
    ]
  },
  "Hydrate": {
    "Cleanse & Prep": [
      {
        "name": "Botanical Cream Cleanse",
        "description": "A rich, creamy cleanse that dissolves impurities while wrapping the skin in comfort."
      },
      {
        "name": "Oxygen Foaming Cleanse",
        "description": "A gentle oxygen cleanse that refreshes dull skin without stripping moisture."
      },
      {
        "name": "Enzyme Powder Cleanse",
        "description": "A mild enzyme activation that smooths dry surface skin while maintaining softness."
      },
      {
        "name": "Charcoal Detox Cleanse",
        "description": "A light detox cleanse that lifts impurities without disturbing delicate moisture levels."
      },
      {
        "name": "Hot Iron Skin Prep",
        "description": "A comforting warming step that softens the skin and enhances hydration absorption."
      }
    ],
    "Exfoliate & Refine": [
      {
        "name": "Enzyme Resurfacing",
        "description": "A delicate exfoliation that lifts dullness while maintaining softness and comfort."
      },
      {
        "name": "Lactic Glow Peel",
        "description": "A moisture-supporting exfoliation that smooths texture and restores radiance."
      },
      {
        "name": "Mandelic Acid Peel",
        "description": "A gentle peel that improves skin smoothness without compromising comfort."
      },
      {
        "name": "Pumpkin Enzyme Treatment",
        "description": "A warming exfoliation that refreshes dry skin and boosts luminosity."
      },
      {
        "name": "Glycolic Micro-Peel",
        "description": "A controlled resurfacing peel designed to revive dull skin while supporting moisture."
      }
    ],
    "Detox & Refresh": [
      {
        "name": "Hydro Extraction",
        "description": "A soft pore cleanse that removes impurities without disrupting moisture."
      },
      {
        "name": "Manual Extractions",
        "description": "Targeted congestion removal performed gently to protect comfort."
      },
      {
        "name": "Oxygenating Mask",
        "description": "A revitalising mask that refreshes dull skin and boosts luminosity."
      },
      {
        "name": "Charcoal Detox Mask",
        "description": "A mild detox treatment that purifies while maintaining hydration."
      },
      {
        "name": "Lymphatic Drainage Massage",
        "description": "A soothing massage that encourages circulation and glow."
      }
    ],
    "Hydro Infusions": [
      {
        "name": "Skin Renewal Infusion",
        "description": "A replenishing infusion that refreshes the skin and restores softness."
      },
      {
        "name": "Deep Hydration Infusion",
        "description": "A deep moisture infusion that plumps the skin and relieves dryness instantly."
      },
      {
        "name": "Antioxidant Infusion",
        "description": "A protective hydration treatment that supports glow and comfort."
      },
      {
        "name": "Glow-Enhancing Infusion",
        "description": "A luminosity-boosting infusion that revives dull, dehydrated skin."
      },
      {
        "name": "Plumping Infusion",
        "description": "A deeply hydrating treatment that smooths and softens the skin."
      }
    ],
    "Mask Bar": [
      {
        "name": "Collagen Fleece Mask",
        "description": "A deeply hydrating collagen mask that restores softness and elasticity."
      },
      {
        "name": "Jelly Hydration Mask",
        "description": "A juicy hydration mask that drenches the skin in moisture."
      },
      {
        "name": "Anti-Age Renewal Mask",
        "description": "A nourishing anti-age mask that smooths fine lines while restoring comfort."
      },
      {
        "name": "Algae Oxygen Mask",
        "description": "A revitalising mask that boosts oxygenation and dull-skin recovery."
      },
      {
        "name": "Cream Comfort Mask",
        "description": "A rich cream mask that comforts dryness and strengthens the skin barrier."
      }
    ],
    "Technology Lounge": [
      {
        "name": "LED Light Therapy",
        "description": "A restorative light treatment that supports skin comfort and recovery."
      },
      {
        "name": "Microcurrent Facial Lift",
        "description": "A soft lifting treatment that tones while maintaining skin hydration."
      },
      {
        "name": "Radiofrequency Skin Tightening",
        "description": "A comforting warming treatment that supports firmness and collagen health."
      },
      {
        "name": "Ultrasound Infusion",
        "description": "A technology step that pushes hydrating actives deeper into the skin."
      },
      {
        "name": "Oxygen Infusion Therapy",
        "description": "A refreshing oxygen treatment that revives dull, dehydrated skin."
      }
    ],
    "Boosters & Infusions": [
      {
        "name": "Hyaluronic Hydration Boost",
        "description": "A deep hydration boost that instantly plumps and softens the skin."
      },
      {
        "name": "Vitamin C Glow Boost",
        "description": "A glow-enhancing boost that brightens while supporting moisture."
      },
      {
        "name": "Peptide Firming Boost",
        "description": "A smoothing boost that supports elasticity and skin comfort."
      },
      {
        "name": "Growth Factor Renewal Boost",
        "description": "An advanced boost designed to support renewal and skin resilience."
      },
      {
        "name": "Niacinamide Balance Boost",
        "description": "A strengthening boost that improves texture and supports the skin barrier."
      }
    ],
    "Finish & Protect": [
      {
        "name": "Barrier Seal + SPF",
        "description": "A protective finishing layer that locks in hydration and protects the skin."
      },
      {
        "name": "Antioxidant Mist",
        "description": "A comforting mist that boosts moisture and soothes dryness."
      },
      {
        "name": "Glow Serum",
        "description": "A hydrating serum that restores plumpness and softness."
      },
      {
        "name": "Hydrating Moisturiser",
        "description": "A rich moisturiser that deeply nourishes and smooths the skin."
      },
      {
        "name": "Eye & Lip Finish",
        "description": "A nourishing finish for delicate eye and lip areas."
      }
    ]
  },
  "Calm": {
    "Cleanse & Prep": [
      {
        "name": "Botanical Cream Cleanse",
        "description": "A lightweight cream cleanse that purifies without heaviness or residue."
      },
      {
        "name": "Oxygen Foaming Cleanse",
        "description": "A clarifying foam that lifts oil, debris and dullness for instantly fresher skin."
      },
      {
        "name": "Enzyme Powder Cleanse",
        "description": "An active enzyme cleanse that smooths texture and refines pores."
      },
      {
        "name": "Charcoal Detox Cleanse",
        "description": "A deep-cleansing detox that draws out excess oil and congestion."
      },
      {
        "name": "Hot Iron Skin Prep",
        "description": "A targeted warming prep that softens oil in the pores for easier, gentler extractions."
      }
    ],
    "Exfoliate & Refine": [
      {
        "name": "Enzyme Resurfacing",
        "description": "A clarifying exfoliation that smooths texture and keeps pores looking clean."
      },
      {
        "name": "Lactic Glow Peel",
        "description": "A refining peel that brightens while helping rebalance excess oil."
      },
      {
        "name": "Mandelic Acid Peel",
        "description": "A pore-refining exfoliation that improves skin clarity and smoothness."
      },
      {
        "name": "Pumpkin Enzyme Treatment",
        "description": "A warming exfoliation that refreshes congested skin and boosts clarity."
      },
      {
        "name": "Glycolic Micro-Peel",
        "description": "A resurfacing peel that refines texture and enhances brightness."
      }
    ],
    "Detox & Refresh": [
      {
        "name": "Hydro Extraction",
        "description": "A deep-cleansing extraction that flushes congestion and excess oil."
      },
      {
        "name": "Manual Extractions",
        "description": "Focused clearing of stubborn blockages for visibly clearer skin."
      },
      {
        "name": "Oxygenating Mask",
        "description": "An energising mask that refreshes and brightens congested skin."
      },
      {
        "name": "Charcoal Detox Mask",
        "description": "A purifying mask that absorbs excess oil and refines pores."
      },
      {
        "name": "Lymphatic Drainage Massage",
        "description": "A detoxifying massage that helps reduce congestion and puffiness."
      }
    ],
    "Hydro Infusions": [
      {
        "name": "Skin Renewal Infusion",
        "description": "A refreshing infusion that cleanses deeply while keeping the skin balanced."
      },
      {
        "name": "Deep Hydration Infusion",
        "description": "A lightweight hydration boost that plumps without heaviness."
      },
      {
        "name": "Antioxidant Infusion",
        "description": "A protective infusion that supports skin clarity and resilience."
      },
      {
        "name": "Glow-Enhancing Infusion",
        "description": "A radiance boost that brightens the complexion without shine."
      },
      {
        "name": "Plumping Infusion",
        "description": "A hydration treatment that smooths fine lines without clogging pores."
      }
    ],
    "Mask Bar": [
      {
        "name": "Collagen Fleece Mask",
        "description": "A lightweight collagen mask that supports firmness without congestion."
      },
      {
        "name": "Jelly Hydration Mask",
        "description": "A refreshing hydration mask that plumps without heaviness."
      },
      {
        "name": "Anti-Age Renewal Mask",
        "description": "A refining anti-age mask that smooths while keeping pores clear."
      },
      {
        "name": "Algae Oxygen Mask",
        "description": "An oxygenating algae mask that revitalises and clarifies congested skin."
      },
      {
        "name": "Cream Comfort Mask",
        "description": "A balancing cream mask that hydrates without clogging pores."
      }
    ],
    "Technology Lounge": [
      {
        "name": "LED Light Therapy",
        "description": "A targeted light treatment that supports clearer-looking skin."
      },
      {
        "name": "Microcurrent Facial Lift",
        "description": "A toning treatment that lifts and sculpts without heaviness."
      },
      {
        "name": "Radiofrequency Skin Tightening",
        "description": "A firming treatment that smooths skin texture and refines contours."
      },
      {
        "name": "Ultrasound Infusion",
        "description": "A technology step that enhances absorption without congestion."
      },
      {
        "name": "Oxygen Infusion Therapy",
        "description": "A refreshing oxygen treatment that revitalises and brightens the skin."
      }
    ],
    "Boosters & Infusions": [
      {
        "name": "Hyaluronic Hydration Boost",
        "description": "A lightweight hydration boost that plumps without heaviness."
      },
      {
        "name": "Vitamin C Glow Boost",
        "description": "A brightening boost that enhances clarity and luminosity."
      },
      {
        "name": "Peptide Firming Boost",
        "description": "A refining boost that supports firmness and smooth skin texture."
      },
      {
        "name": "Growth Factor Renewal Boost",
        "description": "An advanced boost that supports skin renewal and long-term clarity."
      },
      {
        "name": "Niacinamide Balance Boost",
        "description": "A targeted boost that helps regulate oil and refine pores."
      }
    ],
    "Finish & Protect": [
      {
        "name": "Barrier Seal + SPF",
        "description": "A lightweight protective finish that defends the skin without shine."
      },
      {
        "name": "Antioxidant Mist",
        "description": "A refreshing mist that balances and protects the skin."
      },
      {
        "name": "Glow Serum",
        "description": "A refining serum that enhances brightness without heaviness."
      },
      {
        "name": "Hydrating Moisturiser",
        "description": "A lightweight gel moisturiser that hydrates without clogging pores."
      },
      {
        "name": "Eye & Lip Finish",
        "description": "A light, refreshing finish for delicate areas."
      }
    ]
  },
  "Lift": {
    "Cleanse & Prep": [
      {
        "name": "Botanical Cream Cleanse",
        "description": "A harmonising cleanse that softens dry areas while refining oilier zones."
      },
      {
        "name": "Oxygen Foaming Cleanse",
        "description": "A refreshing cleanse that leaves the skin feeling fresh, even and comfortable."
      },
      {
        "name": "Enzyme Powder Cleanse",
        "description": "An intelligent enzyme cleanse that polishes where needed without overdoing it."
      },
      {
        "name": "Charcoal Detox Cleanse",
        "description": "A selective detox cleanse that clears congestion while respecting dry areas."
      },
      {
        "name": "Hot Iron Skin Prep",
        "description": "A warming prep that focuses on congested zones for more effective treatment results."
      }
    ],
    "Exfoliate & Refine": [
      {
        "name": "Enzyme Resurfacing",
        "description": "A balanced exfoliation that polishes where needed and respects delicate areas."
      },
      {
        "name": "Lactic Glow Peel",
        "description": "A refining peel that smooths texture and restores radiance evenly."
      },
      {
        "name": "Mandelic Acid Peel",
        "description": "A gentle resurfacing peel that enhances clarity without over-exfoliation."
      },
      {
        "name": "Pumpkin Enzyme Treatment",
        "description": "A warming exfoliation focused on congested areas while maintaining comfort."
      },
      {
        "name": "Glycolic Micro-Peel",
        "description": "A light peel that smooths uneven areas and boosts brightness."
      }
    ],
    "Detox & Refresh": [
      {
        "name": "Hydro Extraction",
        "description": "A targeted pore cleanse focusing on congested areas while protecting drier zones."
      },
      {
        "name": "Manual Extractions",
        "description": "Selective congestion clearing tailored to the skin\u2019s needs."
      },
      {
        "name": "Oxygenating Mask",
        "description": "A revitalising mask that refreshes and brightens uneven skin."
      },
      {
        "name": "Charcoal Detox Mask",
        "description": "A zone-focused detox that clears congestion without over-drying."
      },
      {
        "name": "Lymphatic Drainage Massage",
        "description": "A massage that encourages drainage and improves skin clarity."
      }
    ],
    "Hydro Infusions": [
      {
        "name": "Skin Renewal Infusion",
        "description": "A balancing infusion that refreshes the skin and restores harmony."
      },
      {
        "name": "Deep Hydration Infusion",
        "description": "A targeted hydration boost that nourishes dry areas without overloading oilier zones."
      },
      {
        "name": "Antioxidant Infusion",
        "description": "A protective infusion that supports overall skin health and glow."
      },
      {
        "name": "Glow-Enhancing Infusion",
        "description": "A radiance-enhancing infusion that leaves the skin even and luminous."
      },
      {
        "name": "Plumping Infusion",
        "description": "A hydration-rich infusion focused where the skin needs it most."
      }
    ],
    "Mask Bar": [
      {
        "name": "Collagen Fleece Mask",
        "description": "A plumping collagen mask that smooths and balances mixed skin types."
      },
      {
        "name": "Jelly Hydration Mask",
        "description": "A hydration mask that adapts to dry and oily areas beautifully."
      },
      {
        "name": "Anti-Age Renewal Mask",
        "description": "A rejuvenating mask that supports firmness and smoothness across zones."
      },
      {
        "name": "Algae Oxygen Mask",
        "description": "An oxygenating mask that refreshes and rebalances uneven skin."
      },
      {
        "name": "Cream Comfort Mask",
        "description": "A targeted cream mask applied where the skin needs extra care."
      }
    ],
    "Technology Lounge": [
      {
        "name": "LED Light Therapy",
        "description": "A balancing light treatment that supports skin harmony and glow."
      },
      {
        "name": "Microcurrent Facial Lift",
        "description": "A toning treatment that lifts and contours evenly."
      },
      {
        "name": "Radiofrequency Skin Tightening",
        "description": "A warming treatment that firms and refines uneven areas."
      },
      {
        "name": "Ultrasound Infusion",
        "description": "A technology step that delivers actives where they\u2019re needed most."
      },
      {
        "name": "Oxygen Infusion Therapy",
        "description": "A revitalising oxygen treatment that refreshes the complexion."
      }
    ],
    "Boosters & Infusions": [
      {
        "name": "Hyaluronic Hydration Boost",
        "description": "A targeted hydration boost that nourishes dry areas without overloading oily zones."
      },
      {
        "name": "Vitamin C Glow Boost",
        "description": "A brightening boost that enhances radiance across the complexion."
      },
      {
        "name": "Peptide Firming Boost",
        "description": "A refining boost that supports firmness and skin smoothness."
      },
      {
        "name": "Growth Factor Renewal Boost",
        "description": "An advanced boost that supports renewal and balance."
      },
      {
        "name": "Niacinamide Balance Boost",
        "description": "A targeted boost used where oil control is needed most."
      }
    ],
    "Finish & Protect": [
      {
        "name": "Barrier Seal + SPF",
        "description": "A tailored protective finish applied strategically across the skin."
      },
      {
        "name": "Antioxidant Mist",
        "description": "A refreshing mist that supports hydration and clarity."
      },
      {
        "name": "Glow Serum",
        "description": "A glow-enhancing serum that smooths and evens the complexion."
      },
      {
        "name": "Hydrating Moisturiser",
        "description": "A targeted moisturiser applied where the skin needs it most."
      },
      {
        "name": "Eye & Lip Finish",
        "description": "A refreshing finish for delicate facial areas."
      }
    ]
  },
  "Clarify": {
    "Cleanse & Prep": [
      {
        "name": "Botanical Cream Cleanse",
        "description": "A soothing cleanse that removes impurities while keeping the skin calm and comfortable."
      },
      {
        "name": "Oxygen Foaming Cleanse",
        "description": "A soft foam cleanse that refreshes the skin without irritation."
      },
      {
        "name": "Enzyme Powder Cleanse",
        "description": "A mild enzyme activation that smooths gently without overstimulation."
      },
      {
        "name": "Charcoal Detox Cleanse",
        "description": "A carefully balanced detox cleanse that purifies without stress to the skin."
      },
      {
        "name": "Hot Iron Skin Prep",
        "description": "A gentle warming step used with care to support treatment penetration and comfort."
      }
    ],
    "Exfoliate & Refine": [
      {
        "name": "Enzyme Resurfacing",
        "description": "A very gentle exfoliation that smooths the skin without irritation."
      },
      {
        "name": "Lactic Glow Peel",
        "description": "A mild exfoliation that enhances glow while maintaining comfort."
      },
      {
        "name": "Mandelic Acid Peel",
        "description": "A low-impact peel that refines texture carefully and evenly."
      },
      {
        "name": "Pumpkin Enzyme Treatment",
        "description": "A carefully controlled exfoliation that refreshes without overstimulation."
      },
      {
        "name": "Glycolic Micro-Peel",
        "description": "A light resurfacing step used conservatively to brighten gently."
      }
    ],
    "Detox & Refresh": [
      {
        "name": "Hydro Extraction",
        "description": "A gentle pore cleanse performed carefully to avoid irritation."
      },
      {
        "name": "Manual Extractions",
        "description": "Very selective congestion clearing used only where appropriate."
      },
      {
        "name": "Oxygenating Mask",
        "description": "A soothing oxygen mask that refreshes without overstimulation."
      },
      {
        "name": "Charcoal Detox Mask",
        "description": "A carefully balanced detox mask used lightly to purify gently."
      },
      {
        "name": "Lymphatic Drainage Massage",
        "description": "A calming massage that reduces puffiness and supports skin comfort."
      }
    ],
    "Hydro Infusions": [
      {
        "name": "Skin Renewal Infusion",
        "description": "A soothing infusion that refreshes the skin while maintaining calm."
      },
      {
        "name": "Deep Hydration Infusion",
        "description": "A gentle hydration boost that plumps the skin without irritation."
      },
      {
        "name": "Antioxidant Infusion",
        "description": "A protective infusion that supports the skin barrier and reduces stress."
      },
      {
        "name": "Glow-Enhancing Infusion",
        "description": "A subtle radiance boost that enhances glow without overstimulation."
      },
      {
        "name": "Plumping Infusion",
        "description": "A soothing hydration treatment that softens and smooths the skin."
      }
    ],
    "Mask Bar": [
      {
        "name": "Collagen Fleece Mask",
        "description": "A soothing collagen mask that hydrates while supporting skin strength."
      },
      {
        "name": "Jelly Hydration Mask",
        "description": "A soft, cooling jelly mask that comforts and hydrates sensitive skin."
      },
      {
        "name": "Anti-Age Renewal Mask",
        "description": "A mild anti-age mask that supports skin renewal comfortably."
      },
      {
        "name": "Algae Oxygen Mask",
        "description": "A gentle oxygenating mask that refreshes without irritation."
      },
      {
        "name": "Cream Comfort Mask",
        "description": "A calming cream mask designed to reduce redness and sensitivity."
      }
    ],
    "Technology Lounge": [
      {
        "name": "LED Light Therapy",
        "description": "A soothing light treatment that supports skin recovery and comfort."
      },
      {
        "name": "Microcurrent Facial Lift",
        "description": "A mild lifting treatment designed to support tone without irritation."
      },
      {
        "name": "Radiofrequency Skin Tightening",
        "description": "A carefully controlled warming treatment used gently for firmness."
      },
      {
        "name": "Ultrasound Infusion",
        "description": "A low-impact technology step that enhances absorption comfortably."
      },
      {
        "name": "Oxygen Infusion Therapy",
        "description": "A calming oxygen treatment that refreshes without overstimulation."
      }
    ],
    "Boosters & Infusions": [
      {
        "name": "Hyaluronic Hydration Boost",
        "description": "A gentle hydration boost that plumps and comforts the skin."
      },
      {
        "name": "Vitamin C Glow Boost",
        "description": "A low-impact brightening boost that enhances glow carefully."
      },
      {
        "name": "Peptide Firming Boost",
        "description": "A mild firming boost designed to support skin structure comfortably."
      },
      {
        "name": "Growth Factor Renewal Boost",
        "description": "An advanced boost focused on skin recovery and resilience."
      },
      {
        "name": "Niacinamide Balance Boost",
        "description": "A strengthening boost that supports the barrier and soothes the skin."
      }
    ],
    "Finish & Protect": [
      {
        "name": "Barrier Seal + SPF",
        "description": "A gentle protective finish that strengthens and shields sensitive skin."
      },
      {
        "name": "Antioxidant Mist",
        "description": "A calming mist that refreshes and reduces visible redness."
      },
      {
        "name": "Glow Serum",
        "description": "A soft glow serum designed to enhance brightness without irritation."
      },
      {
        "name": "Hydrating Moisturiser",
        "description": "A soothing moisturiser that comforts and protects sensitive skin."
      },
      {
        "name": "Eye & Lip Finish",
        "description": "A calming finish for delicate areas."
      }
    ]
  }
};

document.addEventListener('DOMContentLoaded', function() {
  initFacialBundle();
});

// Support for Shopify theme customizer
if (typeof Shopify !== 'undefined' && Shopify.designMode) {
  document.addEventListener('shopify:section:load', function() {
    setTimeout(initFacialBundle, 100);
  });
}

function initFacialBundle() {
  const bundle = document.querySelector('.facial-bundle-grid');
  if (!bundle) {
    setTimeout(initFacialBundle, 100);
    return;
  }

  let selectedSkinType = null;
  let selectedTreatments = {}; // { category: treatmentName }
  let currentCategory = null;
  let selectedAppointmentDate = null;
  let selectedAppointmentTime = null;
  const variantId = '{{ section.settings.variant_id }}';

  // Appointment picker variables
  let currentMonth = new Date().getMonth();
  let currentYear = new Date().getFullYear();
  let appointmentDate = null;
  let appointmentTime = null;

  // Get appointment settings from section
  const defaultSlotsText = `{{ section.settings.default_slots }}`;
  const saturdaySlotsText = `{{ section.settings.saturday_slots }}`;
  const customDatesText = `{{ section.settings.custom_dates }}`;

  // Parse time slots
  const defaultSlots = defaultSlotsText.split('\n').map(s => s.trim()).filter(s => s);
  const saturdaySlots = saturdaySlotsText.split('\n').map(s => s.trim()).filter(s => s);

  // Parse custom dates blocking
  const CUSTOM_DATES = {};
  if (customDatesText.trim()) {
    customDatesText.split('\n').forEach(line => {
      line = line.trim();
      if (!line) return;
      const [date, slotsStr] = line.split('|');
      if (slotsStr === 'CLOSED') {
        CUSTOM_DATES[date.trim()] = 'CLOSED';
      } else {
        CUSTOM_DATES[date.trim()] = slotsStr.split(',').map(s => s.trim());
      }
    });
  }

  // Handle skin type selection
  document.querySelectorAll('.skin-type-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      document.querySelectorAll('.skin-type-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      selectedSkinType = this.dataset.skinType;
      selectedTreatments = {}; // Reset selections
      showCategoryGrid();
      updateAllCards();
    });
  });

  // Show category grid
  function showCategoryGrid() {
    document.getElementById('bundleProgress').style.display = 'block';
    document.getElementById('categoryGrid').style.display = 'grid';
    document.getElementById('treatmentPanel').style.display = 'none';
    document.getElementById('appointmentSection').style.display = 'none';
    document.getElementById('bundleFooter').style.display = 'none';
    
    // Add scroll listener for sticky progress bar
    window.addEventListener('scroll', function() {
      const progressBar = document.getElementById('bundleProgress');
      if (progressBar) {
        if (window.scrollY > 100) {
          progressBar.classList.add('scrolled');
        } else {
          progressBar.classList.remove('scrolled');
        }
      }
    });
  }

  // Handle category card clicks
  document.querySelectorAll('.category-card').forEach(card => {
    card.addEventListener('click', function() {
      if (!selectedSkinType) {
        alert('Please select a skin goal first');
        return;
      }
      currentCategory = this.dataset.category;
      showTreatmentPanel(currentCategory);
    });
  });

  // Show treatment selection panel
  function showTreatmentPanel(category) {
    document.getElementById('categoryGrid').style.display = 'none';
    document.getElementById('treatmentPanel').style.display = 'block';
    document.getElementById('treatmentPanelTitle').textContent = category;
    
    const treatments = TREATMENT_DATA[selectedSkinType][category];
    const treatmentList = document.getElementById('treatmentList');
    treatmentList.innerHTML = '';
    
    treatments.forEach(treatment => {
      const isSelected = selectedTreatments[category] === treatment.name;
      const item = document.createElement('div');
      item.className = 'treatment-item' + (isSelected ? ' selected' : '');
      item.innerHTML = `
        <div class="treatment-radio"></div>
        <div class="treatment-content">
          <span class="treatment-name">${treatment.name}</span>
          <p class="treatment-description">${treatment.description}</p>
        </div>
      `;
      item.addEventListener('click', () => selectTreatment(category, treatment.name));
      treatmentList.appendChild(item);
    });
  }

  // Select treatment
  function selectTreatment(category, treatmentName) {
    selectedTreatments[category] = treatmentName;
    
    // Update UI
    document.querySelectorAll('#treatmentList .treatment-item').forEach(item => {
      item.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
    
    // Auto-navigate back after selection
    setTimeout(() => {
      showCategoryGrid();
      updateAllCards();
      updateProgress();
      checkCompletion();
    }, 500);
  }

  // Back button
  document.getElementById('backBtn').addEventListener('click', function() {
    showCategoryGrid();
    updateAllCards();
  });

  // Update all category cards
  function updateAllCards() {
    document.querySelectorAll('.category-card').forEach(card => {
      const category = card.dataset.category;
      if (selectedTreatments[category]) {
        card.classList.add('completed');
      } else {
        card.classList.remove('completed');
      }
    });
  }

  // Update progress
  function updateProgress() {
    const count = Object.keys(selectedTreatments).length;
    const progressFill = document.getElementById('progressFill');
    const progressCount = document.getElementById('progressCount');
    
    const percentage = (count / 8) * 100;
    progressFill.style.width = percentage + '%';
    progressCount.textContent = `${count} / 8 treatments selected`;
  }

  // Check completion
  function checkCompletion() {
    const count = Object.keys(selectedTreatments).length;
    
    if (count === 8) {
      // Show appointment section
      document.getElementById('appointmentSection').style.display = 'block';
      document.getElementById('bundleFooter').style.display = 'block';
      initializeAppointmentPicker();
    }
  }

  // Initialize Appointment Picker
  function initializeAppointmentPicker() {
    const dropdown = document.getElementById('appointmentDropdown');
    const display = document.getElementById('appointmentDisplay');
    const modal = document.getElementById('appointmentModal');
    const closeBtn = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const confirmBtn = document.getElementById('confirmBtn');

    // Remove previous listeners
    const newDropdown = dropdown.cloneNode(true);
    dropdown.parentNode.replaceChild(newDropdown, dropdown);

    newDropdown.addEventListener('click', () => {
      modal.classList.add('active');
      renderCalendar();
    });

    function closeModal() {
      modal.classList.remove('active');
    }

    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModal();
    });

    document.getElementById('prevMonth').addEventListener('click', () => {
      currentMonth--;
      if (currentMonth < 0) { currentMonth = 11; currentYear--; }
      renderCalendar();
    });

    document.getElementById('nextMonth').addEventListener('click', () => {
      currentMonth++;
      if (currentMonth > 11) { currentMonth = 0; currentYear++; }
      renderCalendar();
    });

    function renderCalendar() {
      const months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
      document.getElementById('monthYear').textContent = `${months[currentMonth]} ${currentYear}`;
      
      const container = document.getElementById('calendarDates');
      container.innerHTML = '';
      
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const today = new Date();
      today.setHours(0,0,0,0);
      
      const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
      const closedDays = [0, 1, 4]; // Sunday, Monday, Thursday closed
      
      for (let i = 0; i < adjustedFirstDay; i++) {
        container.innerHTML += '<div class="calendar-date"></div>';
      }
      
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, currentMonth, day);
        date.setHours(0,0,0,0);
        const dayOfWeek = date.getDay();
        const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
        
        let classes = 'calendar-date';
        if (date < today) classes += ' past';
        else if (closedDays.includes(dayOfWeek)) classes += ' disabled';
        else if (CUSTOM_DATES[dateStr] === 'CLOSED') classes += ' disabled';
        else if (date.getTime() === today.getTime()) classes += ' today';
        if (appointmentDate && date.getTime() === appointmentDate.getTime()) classes += ' selected';
        
        const dateEl = document.createElement('div');
        dateEl.className = classes;
        dateEl.textContent = day;
        if (!classes.includes('past') && !classes.includes('disabled')) {
          dateEl.addEventListener('click', () => selectDate(date));
        }
        container.appendChild(dateEl);
      }
    }

    function selectDate(date) {
      appointmentDate = date;
      appointmentTime = null;
      renderCalendar();
      updateTimeSlots(date);
      confirmBtn.disabled = true;
    }

    function updateTimeSlots(date) {
      const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      document.getElementById('timeHeader').textContent = 
        `${days[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
      
      const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
      
      let slots = date.getDay() === 6 ? [...saturdaySlots] : [...defaultSlots];
      
      if (CUSTOM_DATES[dateStr]) {
        if (CUSTOM_DATES[dateStr] === 'CLOSED') {
          document.getElementById('timeSlots').innerHTML = 
            '<div style="padding:20px;text-align:center;color:#999">No appointments available on this date</div>';
          return;
        } else {
          const blockedTimes = CUSTOM_DATES[dateStr];
          slots = slots.filter(time => !blockedTimes.includes(time));
        }
      }
      
      const container = document.getElementById('timeSlots');
      container.innerHTML = '';
      
      if (slots.length === 0) {
        container.innerHTML = '<div style="padding:20px;text-align:center;color:#999">No available time slots</div>';
        return;
      }
      
      slots.forEach(time => {
        const el = document.createElement('div');
        el.className = 'time-slot-option';
        el.innerHTML = `<span>${time}</span><div class="time-slot-radio"></div>`;
        el.addEventListener('click', () => selectTime(time, el));
        container.appendChild(el);
      });
    }

    function selectTime(time, el) {
      document.querySelectorAll('#timeSlots .time-slot-option').forEach(s => s.classList.remove('selected'));
      el.classList.add('selected');
      appointmentTime = time;
      confirmBtn.disabled = false;
      
      setTimeout(() => {
        const modalContent = document.querySelector('.appointment-modal-content');
        if (modalContent) {
          modalContent.scrollTo({
            top: modalContent.scrollHeight,
            behavior: 'smooth'
          });
        }
      }, 100);
    }

    confirmBtn.addEventListener('click', () => {
      if (!appointmentDate || !appointmentTime) return;
      
      const formattedDate = appointmentDate.toLocaleDateString('en-US', { 
        month: 'long', 
        day: 'numeric', 
        year: 'numeric' 
      });
      
      display.textContent = `${formattedDate} at ${appointmentTime}`;
      selectedAppointmentDate = formattedDate;
      selectedAppointmentTime = appointmentTime;
      
      closeModal();
      updateAddToCartButton();
    });

    renderCalendar();
  }

  // Update add to cart button
  function updateAddToCartButton() {
    const addToCartBtn = document.getElementById('addToCartBtn');
    const selectionsInfo = document.getElementById('selectionsInfo');
    
    const treatmentCount = Object.keys(selectedTreatments).length;
    const hasAppointment = selectedAppointmentDate && selectedAppointmentTime;
    
    if (treatmentCount === 8 && hasAppointment) {
      addToCartBtn.disabled = false;
      selectionsInfo.textContent = '‚úì Facial complete! Ready to add to cart';
    } else if (treatmentCount === 8) {
      addToCartBtn.disabled = true;
      selectionsInfo.textContent = 'Please select an appointment date and time';
    } else {
      addToCartBtn.disabled = true;
      selectionsInfo.textContent = 'Choose appointment date and time to proceed';
    }
  }

  // Handle add to cart
  document.getElementById('addToCartBtn').addEventListener('click', function() {
    if (Object.keys(selectedTreatments).length !== 8) {
      alert('Please select 1 treatment from each of the 8 categories.');
      return;
    }

    if (!selectedAppointmentDate || !selectedAppointmentTime) {
      alert('Please select an appointment date and time.');
      return;
    }

    if (!variantId) {
      alert('Product configuration error. Please contact support.');
      return;
    }

    const properties = {
      'Skin Type': selectedSkinType,
      'Appointment Date': selectedAppointmentDate,
      'Appointment Time': selectedAppointmentTime
    };
    
    let index = 1;
    const buckets = [
      'Cleanse & Prep',
      'Exfoliate & Refine',
      'Detox & Refresh',
      'Hydro Infusions',
      'Mask Bar',
      'Technology Lounge',
      'Boosters & Infusions',
      'Finish & Protect'
    ];
    
    buckets.forEach(bucket => {
      if (selectedTreatments[bucket]) {
        properties[`${index}. ${bucket}`] = selectedTreatments[bucket];
        index++;
      }
    });

    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: variantId,
        quantity: 1,
        properties: properties
      })
    })
    .then(response => response.json())
    .then(data => {
      window.location.href = '/cart';
    })
    .catch(error => {
      console.error('Error:', error);
      alert('There was an error adding to cart. Please try again.');
    });
  });
}
</script>

{% schema %}
{
  "name": "8x8 Facial Bundle - Grid",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Build Your Custom Facial Treatment Bundle"
    },
    {
      "type": "textarea",
      "id": "section_description",
      "label": "Section Description",
      "default": "Create your perfect 8-step facial treatment. Select your skin type, then choose 1 treatment from each of our 8 specialized categories for a completely customized experience."
    },
    {
      "type": "text",
      "id": "variant_id",
      "label": "Product Variant ID",
      "info": "The variant ID for the ¬£99.99 bundle product"
    },
    {
      "type": "header",
      "content": "‚öôÔ∏è Appointment Settings"
    },
    {
      "type": "textarea",
      "id": "default_slots",
      "label": "Default Time Slots (Regular Days)",
      "info": "One time per line. Example: 10:00 AM",
      "default": "9:00 AM\n9:30 AM\n10:00 AM\n10:30 AM\n11:00 AM\n11:30 AM\n12:00 PM\n12:30 PM\n1:00 PM\n1:30 PM\n2:00 PM\n2:30 PM\n3:00 PM\n3:30 PM\n4:00 PM\n4:30 PM\n5:00 PM"
    },
    {
      "type": "textarea",
      "id": "saturday_slots",
      "label": "Saturday Time Slots",
      "info": "One time per line",
      "default": "9:00 AM\n9:30 AM\n10:00 AM\n10:30 AM\n11:00 AM\n11:30 AM\n12:00 PM\n12:30 PM\n1:00 PM"
    },
    {
      "type": "textarea",
      "id": "custom_dates",
      "label": "Custom Dates (Block Specific Times)",
      "info": "Block times on specific dates. Format: 2025-12-25|CLOSED (closes entire day) or 2025-12-31|10:00 AM,2:00 PM (removes only those times)"
    }
  ],
  "presets": [
    {
      "name": "8x8 Facial Bundle - Grid"
    }
  ]
}
{% endschema %}
