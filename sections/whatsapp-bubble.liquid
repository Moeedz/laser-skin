{% comment %}
  WhatsApp Floating Button with Hover Bubble
  Add this as a section in your Shopify theme
{% endcomment %}

{{ 'section-whatsapp-bubble.css' | asset_url | stylesheet_tag }}

<div class="whatsapp-widget" id="whatsapp-widget">
  <a
    href="https://wa.me/{{ section.settings.whatsapp_number }}?text={{ section.settings.prefilled_message | url_encode }}"
    target="_blank"
    rel="noopener noreferrer"
    class="whatsapp-widget__button"
    aria-label="Chat on WhatsApp"
  >
    <div class="whatsapp-widget__bubble">
      <p class="whatsapp-widget__bubble-text">{{ section.settings.bubble_text }}</p>
      <span class="whatsapp-widget__bubble-arrow"></span>
    </div>
    <div class="whatsapp-widget__icon">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39.045 39.044" width="28" height="28" fill="#fff">
        <path d="M19.527 0C8.748 0 0 8.748 0 19.527c0 3.437.893 6.809 2.588 9.779L.045 39.044l9.94-2.498a19.43 19.43 0 009.542 2.498c10.779 0 19.518-8.748 19.518-19.518C39.045 8.748 30.306 0 19.527 0zm0 35.703a16.11 16.11 0 01-8.699-2.528l-.625-.371-6.469 1.697 1.727-6.312-.407-.648a16.07 16.07 0 01-2.463-8.614c0-8.895 7.236-16.131 16.131-16.131 8.896 0 16.122 7.236 16.122 16.131-.009 8.887-7.236 16.122-16.122 16.131l-.195-.355z"/>
        <path d="M28.463 23.637c-.491-.245-2.905-1.434-3.354-1.598-.45-.163-.777-.245-1.104.246-.327.49-1.267 1.597-1.554 1.925-.286.327-.572.368-1.063.123-.49-.246-2.072-.764-3.946-2.436-1.459-1.3-2.443-2.907-2.73-3.398-.286-.49-.03-.756.215-1 .222-.222.491-.572.736-.859.246-.286.327-.49.491-.818.163-.327.082-.613-.041-.858-.123-.246-1.104-2.66-1.513-3.642-.398-.958-.804-.828-1.104-.844-.286-.016-.613-.02-.94-.02s-.859.123-1.309.614c-.449.49-1.717 1.68-1.717 4.093 0 2.414 1.758 4.746 2.003 5.074.246.327 3.46 5.284 8.386 7.41 1.172.506 2.086.808 2.799 1.034 1.176.374 2.246.321 3.091.195.943-.14 2.905-1.188 3.314-2.334.408-1.147.408-2.13.286-2.335-.123-.204-.45-.327-.94-.572z"/>
      </svg>
    </div>
  </a>
</div>

<style>
  .whatsapp-widget {
    position: fixed;
    bottom: {{ section.settings.bottom_position }}px;
    right: {{ section.settings.right_position }}px;
    z-index: 9999;
  }

  .whatsapp-widget__button {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    position: relative;
  }

  .whatsapp-widget__icon {
    width: 60px;
    height: 60px;
    background-color: #25D366;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    flex-shrink: 0;
  }

  .whatsapp-widget__button:hover .whatsapp-widget__icon {
    transform: scale(1.1);
    box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
  }

  .whatsapp-widget__bubble {
    position: absolute;
    right: 72px;
    top: 50%;
    transform: translateY(-50%);
    background: #fff;
    padding: 12px 18px;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-50%) translateX(10px);
    transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
    pointer-events: none;
  }

  .whatsapp-widget__button:hover .whatsapp-widget__bubble {
    opacity: 1;
    visibility: visible;
    transform: translateY(-50%) translateX(0);
  }

  .whatsapp-widget__bubble-text {
    margin: 0;
    font-size: 14px;
    color: #333;
    line-height: 1.4;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }

  .whatsapp-widget__bubble-arrow {
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 6px solid #fff;
  }

  @media screen and (max-width: 768px) {
    .whatsapp-widget__bubble {
      white-space: normal;
      max-width: 220px;
      right: 68px;
    }

    .whatsapp-widget__icon {
      width: 52px;
      height: 52px;
    }

    .whatsapp-widget__icon svg {
      width: 24px;
      height: 24px;
    }
  }
</style>

{% schema %}
{
  "name": "WhatsApp Button",
  "settings": [
    {
      "type": "text",
      "id": "whatsapp_number",
      "label": "WhatsApp Number (with country code)",
      "default": "447798983387",
      "info": "Enter number without + or spaces, e.g. 447798983387"
    },
    {
      "type": "textarea",
      "id": "bubble_text",
      "label": "Bubble Message",
      "default": "Hi, I'm looking for some advice about treatments and would like to speak to a skin specialist."
    },
    {
      "type": "text",
      "id": "prefilled_message",
      "label": "Pre-filled WhatsApp Message",
      "default": "Hi, I'm looking for some advice about treatments and would like to speak to a skin specialist."
    },
    {
      "type": "range",
      "id": "bottom_position",
      "label": "Bottom Position (px)",
      "min": 10,
      "max": 100,
      "step": 5,
      "default": 30
    },
    {
      "type": "range",
      "id": "right_position",
      "label": "Right Position (px)",
      "min": 10,
      "max": 100,
      "step": 5,
      "default": 30
    }
  ],
  "presets": [
    {
      "name": "WhatsApp Button"
    }
  ]
}
{% endschema %}
