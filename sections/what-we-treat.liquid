{% style %}
  .wwt {
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    width: 100%; overflow: hidden; position: relative;
    background-color: var(--section-bg);
    padding: var(--padding-top) 0 var(--padding-bottom);
  }

  .wwt__texture {
    position: absolute; inset: 0; pointer-events: none; z-index: 0;
    opacity: var(--texture-opacity);
  }
  .wwt__texture::before, .wwt__texture::after { content: ''; position: absolute; inset: 0; }
  .wwt__texture::before {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    background-size: 200px 200px;
  }
  .wwt__texture::after {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='f'%3E%3CfeTurbulence type='turbulence' baseFrequency='0.02 0.08' numOctaves='3' seed='2' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23f)' opacity='0.035'/%3E%3C/svg%3E");
    background-size: 512px 512px;
  }

  .wwt__container {
    position: relative; z-index: 1;
    max-width: 1100px; margin: 0 auto; padding: 0 40px;
  }

  /* Header */
  .wwt__header { text-align: center; margin-bottom: 36px; }

  .wwt__heading {
    font-family: 'Georgia', 'Times New Roman', serif;
    font-size: var(--heading-size); font-weight: 400; font-style: italic;
    line-height: 1.2; color: var(--heading-color); margin: 0 0 16px;
  }

  .wwt__subtitle {
    font-size: var(--body-size); line-height: 1.65;
    color: var(--text-color); margin: 0 auto; max-width: 620px;
  }

  /* Icon Grid */
  .wwt__grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    margin-bottom: 48px;
  }

  .wwt__tile {
    background: var(--tile-bg);
    border-radius: 12px;
    padding: 28px 16px 24px;
    text-align: center;
    transition: transform 0.3s var(--ease-out-expo), box-shadow 0.3s ease;
  }

  .wwt__tile:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.05);
  }

  .wwt__tile-icon {
    width: 56px; height: 56px;
    margin: 0 auto 14px;
    display: flex; align-items: center; justify-content: center;
    color: var(--icon-color);
  }

  .wwt__tile-icon img {
    width: 56px; height: 56px; object-fit: contain;
  }

  .wwt__tile-title {
    font-family: 'Georgia', 'Times New Roman', serif;
    font-size: var(--tile-title-size); font-weight: 600;
    color: var(--heading-color); margin: 0 0 4px; line-height: 1.3;
  }

  .wwt__tile-sub {
    font-size: calc(var(--body-size) - 2px);
    color: var(--text-color); opacity: 0.75; margin: 0; line-height: 1.4;
  }

  /* How it works subsection */
  .wwt__how { max-width: 600px; margin: 0 auto; }

  .wwt__how-title-wrap {
    display: flex; align-items: center; gap: 14px;
    justify-content: center; margin-bottom: 24px;
  }

  .wwt__how-line {
    flex: 0 0 60px; height: 1px;
    background: var(--accent-color); opacity: 0.4;
  }

  .wwt__how-title {
    font-family: 'Georgia', 'Times New Roman', serif;
    font-size: calc(var(--heading-size) * 0.6); font-weight: 700; font-style: italic;
    color: var(--heading-color); margin: 0; line-height: 1.3;
    white-space: nowrap;
  }

  .wwt__how-list {
    list-style: none; margin: 0; padding: 0;
    display: flex; flex-direction: column; gap: 12px;
  }

  .wwt__how-item {
    display: flex; align-items: flex-start; gap: 14px;
    font-size: var(--body-size); line-height: 1.55; color: var(--text-color);
  }

  .wwt__how-icon {
    flex-shrink: 0; width: 24px; height: 24px;
    color: var(--icon-color); margin-top: 1px;
    display: flex; align-items: center; justify-content: center;
  }

  .wwt__how-icon img {
    width: 24px; height: 24px; object-fit: contain;
  }

  .wwt__how-icon svg { width: 22px; height: 22px; }

  /* Animations */
  [data-wwt-animate] {
    opacity: 0; transform: translateY(20px);
    transition: opacity 0.6s var(--ease-out-expo), transform 0.6s var(--ease-out-expo);
  }
  [data-wwt-animate].is-visible { opacity: 1; transform: translateY(0); }

  /* Responsive */
  @media screen and (max-width: 768px) {
    .wwt__container { padding: 0 20px; }
    .wwt__heading { font-size: calc(var(--heading-size) * 0.65); }
    .wwt__grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
    .wwt__tile { padding: 22px 12px 18px; }
    .wwt__tile-icon { width: 44px; height: 44px; margin-bottom: 10px; }
    .wwt__tile-icon img { width: 44px; height: 44px; }
    .wwt__how-line { flex: 0 0 40px; }
  }

  @media screen and (max-width: 480px) {
    .wwt__container { padding: 0 16px; }
    .wwt__heading { font-size: calc(var(--heading-size) * 0.52); }
    .wwt__tile-title { font-size: calc(var(--tile-title-size) * 0.88); }
    .wwt__how-title { font-size: calc(var(--heading-size) * 0.42); }
  }
{% endstyle %}

{% assign tile_blocks = section.blocks | where: 'type', 'tile' %}
{% assign how_blocks = section.blocks | where: 'type', 'how_item' %}

<section
  class="wwt"
  id="wwt-{{ section.id }}"
  style="
    --section-bg: {{ section.settings.section_bg }};
    --heading-color: {{ section.settings.heading_color }};
    --text-color: {{ section.settings.text_color }};
    --icon-color: {{ section.settings.icon_color }};
    --accent-color: {{ section.settings.accent_color }};
    --tile-bg: {{ section.settings.tile_bg }};
    --heading-size: {{ section.settings.heading_font_size }}px;
    --tile-title-size: {{ section.settings.tile_title_font_size }}px;
    --body-size: {{ section.settings.body_font_size }}px;
    --texture-opacity: {{ section.settings.texture_opacity | divided_by: 100.0 }};
    --padding-top: {{ section.settings.padding_top }}px;
    --padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>
  {% if section.settings.show_texture %}<div class="wwt__texture"></div>{% endif %}

  <div class="wwt__container">
    <div class="wwt__header" data-wwt-animate data-delay="0">
      {% if section.settings.heading != blank %}
        <h2 class="wwt__heading">{{ section.settings.heading }}</h2>
      {% endif %}
      {% if section.settings.subtitle != blank %}
        <p class="wwt__subtitle">{{ section.settings.subtitle }}</p>
      {% endif %}
    </div>

    {% if tile_blocks.size > 0 %}
      <div class="wwt__grid" data-wwt-animate data-delay="1">
        {% for block in tile_blocks %}
          <div class="wwt__tile" {{ block.shopify_attributes }}>
            {% if block.settings.icon_image != blank %}
              <div class="wwt__tile-icon">
                {{ block.settings.icon_image | image_url: width: 120 | image_tag: loading: 'lazy', widths: '60,90,120' }}
              </div>
            {% endif %}
            {% if block.settings.title != blank %}
              <p class="wwt__tile-title">{{ block.settings.title }}</p>
            {% endif %}
            {% if block.settings.subtitle != blank %}
              <p class="wwt__tile-sub">{{ block.settings.subtitle }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {% if how_blocks.size > 0 or section.settings.how_title != blank %}
      <div class="wwt__how" data-wwt-animate data-delay="2">
        {% if section.settings.how_title != blank %}
          <div class="wwt__how-title-wrap">
            <span class="wwt__how-line"></span>
            <h3 class="wwt__how-title">{{ section.settings.how_title }}</h3>
            <span class="wwt__how-line"></span>
          </div>
        {% endif %}

        {% if how_blocks.size > 0 %}
          <ul class="wwt__how-list">
            {% for block in how_blocks %}
              <li class="wwt__how-item" {{ block.shopify_attributes }}>
                <span class="wwt__how-icon">
                  {% if block.settings.icon_image != blank %}
                    {{ block.settings.icon_image | image_url: width: 48 | image_tag: loading: 'lazy' }}
                  {% else %}
                    {% case block.settings.icon %}
                      {% when 'clipboard' %}
                        <svg viewBox="0 0 22 22" fill="none"><rect x="4" y="2" width="14" height="18" rx="2" stroke="currentColor" stroke-width="1.6"/><path d="M8 2V4H14V2" stroke="currentColor" stroke-width="1.6"/><path d="M8 10H14M8 13H12" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/></svg>
                      {% when 'medical' %}
                        <svg viewBox="0 0 22 22" fill="none"><rect x="3" y="4" width="16" height="14" rx="2" stroke="currentColor" stroke-width="1.6"/><path d="M8 11H14M11 8V14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
                      {% when 'heart' %}
                        <svg viewBox="0 0 22 22" fill="none"><path d="M11 19S3 14 3 9C3 6.2 5.2 4 8 4C9.5 4 10.8 4.8 11 5.5C11.2 4.8 12.5 4 14 4C16.8 4 19 6.2 19 9C19 14 11 19 11 19Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/></svg>
                      {% when 'checkmark' %}
                        <svg viewBox="0 0 22 22" fill="none"><path d="M4 11.5L9 16.5L18 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    {% endcase %}
                  {% endif %}
                </span>
                <span>{{ block.settings.text }}</span>
              </li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var s = document.getElementById('wwt-{{ section.id }}');
    if (!s) return;
    var els = s.querySelectorAll('[data-wwt-animate]');
    var obs = new IntersectionObserver(function (entries) {
      entries.forEach(function (e) {
        if (e.isIntersecting) {
          var d = parseInt(e.target.getAttribute('data-delay') || '0', 10);
          setTimeout(function () { e.target.classList.add('is-visible'); }, d * 150);
          obs.unobserve(e.target);
        }
      });
    }, { threshold: 0.1 });
    els.forEach(function (el) { obs.observe(el); });
  });
</script>

{% schema %}
{
  "name": "What We Treat",
  "tag": "section",
  "class": "what-we-treat-section",
  "settings": [
    { "type": "textarea", "id": "heading", "label": "Heading", "default": "What we treat" },
    { "type": "textarea", "id": "subtitle", "label": "Subtitle", "default": "Safe, targeted treatment designed to remove visible skin blemishes with precision and minimal disruption to surrounding skin." },
    { "type": "text", "id": "how_title", "label": "How It Works Title", "default": "How it works" },
    { "type": "header", "content": "Background & Texture" },
    { "type": "color", "id": "section_bg", "label": "Section Background", "default": "#e8e2dc" },
    { "type": "checkbox", "id": "show_texture", "label": "Show Paper Texture", "default": true },
    { "type": "range", "id": "texture_opacity", "label": "Texture Intensity", "min": 0, "max": 100, "step": 5, "default": 80, "unit": "%" },
    { "type": "header", "content": "Colors" },
    { "type": "color", "id": "heading_color", "label": "Heading Color", "default": "#3a3028" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#555555" },
    { "type": "color", "id": "icon_color", "label": "Icon Color", "default": "#b09a70" },
    { "type": "color", "id": "accent_color", "label": "Accent / Line Color", "default": "#b08d57" },
    { "type": "color", "id": "tile_bg", "label": "Tile Background", "default": "#efebe5" },
    { "type": "header", "content": "Typography" },
    { "type": "range", "id": "heading_font_size", "label": "Heading Font Size", "min": 28, "max": 56, "step": 2, "default": 40, "unit": "px" },
    { "type": "range", "id": "tile_title_font_size", "label": "Tile Title Font Size", "min": 16, "max": 26, "step": 1, "default": 20, "unit": "px" },
    { "type": "range", "id": "body_font_size", "label": "Body Font Size", "min": 14, "max": 20, "step": 1, "default": 16, "unit": "px" },
    { "type": "header", "content": "Layout" },
    { "type": "range", "id": "padding_top", "label": "Padding Top", "min": 0, "max": 120, "step": 4, "default": 72, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Padding Bottom", "min": 0, "max": 120, "step": 4, "default": 72, "unit": "px" }
  ],
  "blocks": [
    {
      "type": "tile",
      "name": "Treatment Tile",
      "settings": [
        { "type": "image_picker", "id": "icon_image", "label": "Icon Image" },
        { "type": "text", "id": "title", "label": "Title", "default": "Spider Veins" },
        { "type": "text", "id": "subtitle", "label": "Subtitle (optional)", "default": "Thread veins" }
      ]
    },
    {
      "type": "how_item",
      "name": "How It Works Item",
      "settings": [
        {
          "type": "select", "id": "icon", "label": "Icon",
          "options": [
            { "value": "clipboard", "label": "Clipboard / Consultation" },
            { "value": "medical", "label": "Medical / Technology" },
            { "value": "heart", "label": "Heart / Aftercare" },
            { "value": "checkmark", "label": "Checkmark" }
          ],
          "default": "clipboard"
        },
        { "type": "image_picker", "id": "icon_image", "label": "Custom Icon (overrides above)" },
        { "type": "text", "id": "text", "label": "Text", "default": "Consultation-led and tailored to you" }
      ]
    }
  ],
  "presets": [
    {
      "name": "What We Treat",
      "blocks": [
        { "type": "tile", "settings": { "title": "Spider Veins", "subtitle": "Thread veins" } },
        { "type": "tile", "settings": { "title": "Skin Tags", "subtitle": "" } },
        { "type": "tile", "settings": { "title": "Moles", "subtitle": "(Only where suitable)" } },
        { "type": "tile", "settings": { "title": "Skin Blemishes", "subtitle": "" } },
        { "type": "tile", "settings": { "title": "Pigmentation", "subtitle": "" } },
        { "type": "tile", "settings": { "title": "Warts", "subtitle": "" } },
        { "type": "tile", "settings": { "title": "Verrucas", "subtitle": "" } },
        { "type": "tile", "settings": { "title": "Milia", "subtitle": "" } },
        { "type": "how_item", "settings": { "icon": "clipboard", "text": "Consultation-led and tailored to you" } },
        { "type": "how_item", "settings": { "icon": "medical", "text": "Medical-grade technology" } },
        { "type": "how_item", "settings": { "icon": "heart", "text": "Comprehensive aftercare guidance" } }
      ]
    }
  ]
}
{% endschema %}
