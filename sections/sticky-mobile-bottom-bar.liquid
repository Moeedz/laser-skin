{% comment %}
  Sticky Mobile Bottom Bar Section with Contact Options
  Save this file as: sections/sticky-mobile-bottom-bar.liquid
{% endcomment %}

<div class="sticky-mobile-bar">
  <button type="button" class="sticky-bar-button" id="contactButton">
    {{ section.settings.button_text }}
  </button>
</div>

<!-- Contact Options Modal -->
<div class="contact-modal-overlay" id="contactModal">
  <div class="contact-modal">
    <button type="button" class="contact-modal-close" id="closeContactModal" aria-label="Close">×</button>
    
    <div class="contact-modal-content">
      <h3 class="contact-modal-title">How would you like to contact us?</h3>
      <p class="contact-modal-subtitle">Choose your preferred method to get in touch with us</p>
      
      <div class="contact-options">
        <a href="{{ section.settings.contact_form_url }}" class="contact-option">
          <div class="contact-option-icon" style="background: #FFF3E0;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" fill="#FF9800"/>
            </svg>
          </div>
          <div class="contact-option-text">
            <div class="contact-option-title">Contact Form</div>
            <div class="contact-option-desc">Fill out our online form</div>
          </div>
          <svg class="contact-option-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18l6-6-6-6" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>

        <button type="button" class="contact-option" id="callOption">
          <div class="contact-option-icon" style="background: #E3F2FD;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" fill="#2196F3"/>
            </svg>
          </div>
          <div class="contact-option-text">
            <div class="contact-option-title">Call Us</div>
            <div class="contact-option-desc">{{ section.settings.phone_number }}</div>
          </div>
          <svg class="contact-option-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18l6-6-6-6" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <a href="https://wa.me/{{ section.settings.whatsapp_number }}" target="_blank" class="contact-option">
          <div class="contact-option-icon" style="background: #E8F5E9;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" fill="#25D366"/>
            </svg>
          </div>
          <div class="contact-option-text">
            <div class="contact-option-title">WhatsApp</div>
            <div class="contact-option-desc">+{{ section.settings.whatsapp_number }}</div>
          </div>
          <svg class="contact-option-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18l6-6-6-6" stroke="#999" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Call Hours Modal -->
<div class="call-modal-overlay" id="callModal">
  <div class="call-modal">
    <button type="button" class="call-modal-close" id="closeCallModal" aria-label="Close">×</button>
    
    <div class="call-modal-content">
      <div class="call-modal-icon">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" fill="currentColor"/>
        </svg>
      </div>
      
      <h3 class="call-modal-title">Call Us</h3>
      
      <div class="call-status" id="callStatus"></div>
      
      <div class="closed-message" id="closedMessage">
        You can send us a WhatsApp, send us an email or call back during opening hours
      </div>
      
      <div class="opening-hours">
        <h4>Opening Hours</h4>
        <div class="hours-list">
          {% if section.settings.monday_hours != blank %}
            <div class="hours-item">
              <span class="day">Monday</span>
              <span class="time">{{ section.settings.monday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.tuesday_hours != blank %}
            <div class="hours-item">
              <span class="day">Tuesday</span>
              <span class="time">{{ section.settings.tuesday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.wednesday_hours != blank %}
            <div class="hours-item">
              <span class="day">Wednesday</span>
              <span class="time">{{ section.settings.wednesday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.thursday_hours != blank %}
            <div class="hours-item">
              <span class="day">Thursday</span>
              <span class="time">{{ section.settings.thursday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.friday_hours != blank %}
            <div class="hours-item">
              <span class="day">Friday</span>
              <span class="time">{{ section.settings.friday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.saturday_hours != blank %}
            <div class="hours-item">
              <span class="day">Saturday</span>
              <span class="time">{{ section.settings.saturday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.sunday_hours != blank %}
            <div class="hours-item">
              <span class="day">Sunday</span>
              <span class="time">{{ section.settings.sunday_hours }}</span>
            </div>
          {% endif %}
        </div>
      </div>
      
      <a href="tel:{{ section.settings.phone_number }}" class="call-now-btn" id="callNowBtn">
        Call Now
      </a>
    </div>
  </div>
</div>

<style>
  .sticky-mobile-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: none;
    background: white;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 999;
    padding: 10px;
  }

  @media (max-width: 768px) {
    .sticky-mobile-bar {
      display: block;
    }
  }

  .sticky-bar-button {
    width: 100%;
    background: {{ section.settings.button_bg_color }};
    color: {{ section.settings.button_text_color }};
    border: none;
    padding: 15px 20px;
    border-radius: 4px;
    font-weight: 600;
    text-align: center;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: opacity 0.3s ease;
    cursor: pointer;
  }

  .sticky-bar-button:hover {
    opacity: 0.9;
  }

  /* Contact Options Modal */
  .contact-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    padding: 15px;
  }

  .contact-modal-overlay.active {
    display: flex;
  }

  .contact-modal {
    background: white;
    border-radius: 12px;
    max-width: 400px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from {
      transform: translateY(50px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .contact-modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: white;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #666;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    z-index: 10;
  }

  .contact-modal-content {
    padding: 24px;
  }

  .contact-modal-title {
    font-size: 20px;
    font-weight: 700;
    margin: 0 0 8px;
    color: #000;
  }

  .contact-modal-subtitle {
    font-size: 14px;
    color: #666;
    margin: 0 0 24px;
  }

  .contact-options {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .contact-option {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    text-decoration: none;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
    width: 100%;
  }

  .contact-option:hover {
    border-color: #ccc;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .contact-option-icon {
    width: 48px;
    height: 48px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .contact-option-text {
    flex: 1;
    text-align: left;
  }

  .contact-option-title {
    font-size: 16px;
    font-weight: 600;
    color: #000;
    margin-bottom: 4px;
  }

  .contact-option-desc {
    font-size: 13px;
    color: #666;
  }

  .contact-option-arrow {
    flex-shrink: 0;
  }

  /* Call Hours Modal */
  .call-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10000;
    align-items: center;
    justify-content: center;
    padding: 15px;
  }

  .call-modal-overlay.active {
    display: flex;
  }

  .call-modal {
    background: white;
    border-radius: 12px;
    max-width: 400px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    animation: slideUp 0.3s ease;
  }

  .call-modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: white;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #666;
    line-height: 1;
    padding: 0;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    z-index: 10;
  }

  .call-modal-content {
    padding: 20px;
    text-align: center;
  }

  .call-modal-icon {
    width: 60px;
    height: 60px;
    background: {{ section.settings.call_bg_color }};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px;
    color: white;
  }

  .call-modal-icon svg {
    width: 32px;
    height: 32px;
  }

  .call-modal-title {
    font-size: 20px;
    margin: 0 0 12px;
    color: #333;
  }

  .call-status {
    padding: 10px 16px;
    border-radius: 6px;
    margin-bottom: 12px;
    font-weight: 600;
    font-size: 14px;
  }

  .call-status.open {
    background: #d4edda;
    color: #155724;
  }

  .call-status.closed {
    background: #f8d7da;
    color: #721c24;
  }

  .closed-message {
    display: none;
    background: #fff3cd;
    color: #856404;
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 12px;
    font-size: 13px;
    line-height: 1.4;
    border-left: 3px solid #ffc107;
  }

  .closed-message.show {
    display: block;
  }

  .opening-hours {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    text-align: left;
  }

  .opening-hours h4 {
    margin: 0 0 12px;
    font-size: 15px;
    color: #333;
    font-weight: 600;
  }

  .hours-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .hours-item {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
  }

  .hours-item .day {
    color: #666;
  }

  .hours-item .time {
    color: #333;
    font-weight: 600;
  }

  .call-now-btn {
    display: inline-block;
    background: {{ section.settings.call_bg_color }};
    color: white;
    padding: 12px 32px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
    font-size: 15px;
    transition: opacity 0.3s ease;
  }

  .call-now-btn:hover {
    opacity: 0.9;
  }

  .call-now-btn.disabled {
    background: #ccc;
    cursor: not-allowed;
    pointer-events: none;
  }
</style>

<script>
  (function() {
    const contactButton = document.getElementById('contactButton');
    const contactModal = document.getElementById('contactModal');
    const closeContactModal = document.getElementById('closeContactModal');
    const callOption = document.getElementById('callOption');
    const callModal = document.getElementById('callModal');
    const closeCallModal = document.getElementById('closeCallModal');
    const callStatus = document.getElementById('callStatus');
    const callNowBtn = document.getElementById('callNowBtn');

    const openingHours = {
      1: '{{ section.settings.monday_hours }}',
      2: '{{ section.settings.tuesday_hours }}',
      3: '{{ section.settings.wednesday_hours }}',
      4: '{{ section.settings.thursday_hours }}',
      5: '{{ section.settings.friday_hours }}',
      6: '{{ section.settings.saturday_hours }}',
      0: '{{ section.settings.sunday_hours }}'
    };

    const timezone = '{{ section.settings.timezone }}' || 'UTC';

    function checkIfOpen() {
      try {
        const now = new Date().toLocaleString('en-US', { timeZone: timezone });
        const currentDate = new Date(now);
        const day = currentDate.getDay();
        const currentTime = currentDate.getHours() * 60 + currentDate.getMinutes();

        const todayHours = openingHours[day];

        if (!todayHours || todayHours === 'Closed') {
          return { isOpen: false, message: 'We are currently closed' };
        }

        const timeRanges = todayHours.split(',').map(t => t.trim());
        
        for (let range of timeRanges) {
          const [start, end] = range.split('-').map(t => t.trim());
          const startMinutes = parseTime(start);
          const endMinutes = parseTime(end);

          if (currentTime >= startMinutes && currentTime <= endMinutes) {
            return { isOpen: true, message: '✓ We are currently open' };
          }
        }

        return { isOpen: false, message: 'We are currently closed' };
      } catch (error) {
        console.error('Error checking opening hours:', error);
        return { isOpen: true, message: 'Call to check our hours' };
      }
    }

    function parseTime(timeStr) {
      const [time, period] = timeStr.split(/(?=[AP]M)/i);
      let [hours, minutes] = time.split(':').map(Number);
      
      if (period && period.toUpperCase() === 'PM' && hours !== 12) {
        hours += 12;
      } else if (period && period.toUpperCase() === 'AM' && hours === 12) {
        hours = 0;
      }
      
      return hours * 60 + (minutes || 0);
    }

    // Open contact options modal
    contactButton.addEventListener('click', function() {
      contactModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    });

    // Close contact options modal
    closeContactModal.addEventListener('click', function() {
      contactModal.classList.remove('active');
      document.body.style.overflow = '';
    });

    contactModal.addEventListener('click', function(e) {
      if (e.target === contactModal) {
        contactModal.classList.remove('active');
        document.body.style.overflow = '';
      }
    });

    // Open call hours modal
    callOption.addEventListener('click', function() {
      const status = checkIfOpen();
      const closedMessage = document.getElementById('closedMessage');
      
      callStatus.textContent = status.message;
      callStatus.className = 'call-status ' + (status.isOpen ? 'open' : 'closed');
      
      if (!status.isOpen) {
        callNowBtn.classList.add('disabled');
        callNowBtn.textContent = 'Currently Closed';
        closedMessage.classList.add('show');
      } else {
        callNowBtn.classList.remove('disabled');
        callNowBtn.textContent = 'Call Now';
        closedMessage.classList.remove('show');
      }
      
      contactModal.classList.remove('active');
      callModal.classList.add('active');
    });

    // Close call hours modal
    closeCallModal.addEventListener('click', function() {
      callModal.classList.remove('active');
      document.body.style.overflow = '';
    });

    callModal.addEventListener('click', function(e) {
      if (e.target === callModal) {
        callModal.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Sticky Mobile Bottom Bar",
  "settings": [
    {
      "type": "header",
      "content": "Main Button Settings"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "BOOK FREE CONSULTATION"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background Color",
      "default": "#1a3a52"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Contact Form Settings"
    },
    {
      "type": "url",
      "id": "contact_form_url",
      "label": "Contact Form Page URL",
      "info": "Select the page with your contact form"
    },
    {
      "type": "header",
      "content": "Call Button Settings"
    },
    {
      "type": "text",
      "id": "phone_number",
      "label": "Phone Number",
      "info": "Enter your landline number",
      "default": "+441234567890"
    },
    {
      "type": "color",
      "id": "call_bg_color",
      "label": "Call Button Color",
      "default": "#0066cc"
    },
    {
      "type": "select",
      "id": "timezone",
      "label": "Timezone",
      "options": [
        { "value": "Europe/London", "label": "UK (London)" },
        { "value": "Europe/Paris", "label": "Europe (Paris)" },
        { "value": "America/New_York", "label": "US Eastern" },
        { "value": "America/Chicago", "label": "US Central" },
        { "value": "America/Denver", "label": "US Mountain" },
        { "value": "America/Los_Angeles", "label": "US Pacific" },
        { "value": "Asia/Dubai", "label": "UAE (Dubai)" },
        { "value": "Asia/Karachi", "label": "Pakistan (Karachi)" },
        { "value": "Asia/Kolkata", "label": "India (Delhi)" },
        { "value": "Asia/Singapore", "label": "Singapore" },
        { "value": "Australia/Sydney", "label": "Australia (Sydney)" }
      ],
      "default": "Europe/London"
    },
    {
      "type": "header",
      "content": "Opening Hours"
    },
    {
      "type": "text",
      "id": "monday_hours",
      "label": "Monday",
      "info": "Format: 9:00AM-5:00PM or 9:00AM-1:00PM, 2:00PM-6:00PM (use 'Closed' if closed)",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "tuesday_hours",
      "label": "Tuesday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "wednesday_hours",
      "label": "Wednesday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "thursday_hours",
      "label": "Thursday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "friday_hours",
      "label": "Friday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "saturday_hours",
      "label": "Saturday",
      "default": "10:00AM-2:00PM"
    },
    {
      "type": "text",
      "id": "sunday_hours",
      "label": "Sunday",
      "default": "Closed"
    },
    {
      "type": "header",
      "content": "WhatsApp Settings"
    },
    {
      "type": "text",
      "id": "whatsapp_number",
      "label": "WhatsApp Number",
      "info": "Enter number with country code (e.g., 923001234567)",
      "default": "923001234567"
    }
  ],
  "presets": [
    {
      "name": "Sticky Mobile Bottom Bar"
    }
  ]
}
{% endschema %}