{% style %}
  .frv {
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
    width: 100%; overflow: hidden; position: relative;
    background-color: var(--section-bg);
    padding: var(--padding-top) 0 var(--padding-bottom);
  }

  .frv__texture {
    position: absolute; inset: 0; pointer-events: none; z-index: 0;
    opacity: var(--texture-opacity);
  }
  .frv__texture::before, .frv__texture::after { content: ''; position: absolute; inset: 0; }
  .frv__texture::before {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
    background-size: 200px 200px;
  }
  .frv__texture::after {
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='f'%3E%3CfeTurbulence type='turbulence' baseFrequency='0.02 0.08' numOctaves='3' seed='2' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23f)' opacity='0.035'/%3E%3C/svg%3E");
    background-size: 512px 512px;
  }

  .frv__container {
    position: relative; z-index: 1;
    max-width: 1100px; margin: 0 auto; padding: 0 40px;
  }

  /* Header: Google logo + stars */
  .frv__header {
    text-align: center; margin-bottom: 36px;
    display: flex; flex-direction: column; align-items: center; gap: 10px;
  }

  .frv__google-text {
    font-size: 28px; font-weight: 500; color: var(--heading-color);
    display: flex; align-items: center; gap: 10px;
  }

  .frv__google-g { display: inline-flex; align-items: center; }
  .frv__google-g svg { width: 28px; height: 28px; }

  .frv__stars { display: flex; gap: 4px; color: var(--star-color); }
  .frv__stars svg { width: 28px; height: 28px; }

  /* Slider */
  .frv__slider { position: relative; }

  .frv__slides { position: relative; overflow: hidden; }

  .frv__slide {
    display: none;
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  .frv__slide.is-active {
    display: block;
    opacity: 1;
  }

  .frv__slide.is-exiting {
    display: block;
    opacity: 0;
    position: absolute; inset: 0;
  }

  /* Layout: quote left, image right */
  .frv__layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 44px;
    align-items: start;
  }

  /* Quote */
  .frv__quote-wrap { position: relative; }

  .frv__quote-mark {
    font-family: 'Georgia', serif;
    font-size: 80px; line-height: 1;
    color: var(--accent-color); opacity: 0.25;
    position: absolute; top: -20px; left: -8px;
    pointer-events: none;
  }

  .frv__quote-text {
    font-family: 'Georgia', 'Times New Roman', serif;
    font-size: var(--body-size); font-style: italic;
    line-height: 1.7; color: var(--text-color);
    margin: 0; padding-top: 24px;
  }

  .frv__quote-text p { margin: 0 0 16px; }
  .frv__quote-text p:last-child { margin-bottom: 0; }

  .frv__author {
    font-size: var(--body-size); font-weight: 600;
    color: var(--heading-color); margin-top: 20px;
    text-align: center;
  }

  .frv__heart {
    display: block; text-align: center; margin-top: 8px;
    color: var(--accent-color); opacity: 0.5;
  }

  /* Image */
  .frv__image {
    border-radius: 12px; overflow: hidden;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
  }

  .frv__image img {
    width: 100%; height: auto; display: block;
    object-fit: cover; aspect-ratio: 4 / 3;
  }

  /* Navigation arrows */
  .frv__nav {
    position: absolute; top: 50%; z-index: 5;
    transform: translateY(-50%);
    width: 44px; height: 44px; border-radius: 50%;
    background: var(--section-bg); border: 1px solid rgba(0,0,0,0.1);
    color: var(--heading-color);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    transition: background 0.3s ease, box-shadow 0.3s ease, transform 0.3s var(--ease-out-expo);
    box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  }

  .frv__nav:hover {
    background: var(--heading-color); color: var(--section-bg);
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    transform: translateY(-50%) scale(1.05);
  }

  .frv__nav svg { width: 20px; height: 20px; }

  .frv__nav--prev { left: -22px; }
  .frv__nav--next { right: -22px; }

  /* Dots */
  .frv__dots {
    display: flex; justify-content: center; gap: 10px;
    margin-top: 32px;
  }

  .frv__dot {
    width: 10px; height: 10px; border-radius: 50%;
    background: var(--heading-color); opacity: 0.2;
    cursor: pointer; border: none; padding: 0;
    transition: opacity 0.3s ease, transform 0.3s var(--ease-out-expo);
  }

  .frv__dot:hover { opacity: 0.4; }

  .frv__dot.is-active {
    opacity: 0.7;
    transform: scale(1.25);
  }

  /* Animations */
  [data-frv-animate] {
    opacity: 0; transform: translateY(24px);
    transition: opacity 0.7s var(--ease-out-expo), transform 0.7s var(--ease-out-expo);
  }
  [data-frv-animate].is-visible { opacity: 1; transform: translateY(0); }

  /* Responsive */
  @media screen and (max-width: 768px) {
    .frv__container { padding: 0 20px; }
    .frv__layout { grid-template-columns: 1fr; gap: 28px; }
    .frv__image { order: -1; max-width: 450px; margin: 0 auto; }
    .frv__google-text { font-size: 24px; }
    .frv__google-g svg { width: 24px; height: 24px; }
    .frv__stars svg { width: 24px; height: 24px; }
    .frv__quote-mark { font-size: 60px; top: -14px; }
    .frv__quote-text { font-size: 15px; }
    .frv__nav--prev { left: -6px; }
    .frv__nav--next { right: -6px; }
    .frv__nav { width: 38px; height: 38px; }
    .frv__nav svg { width: 16px; height: 16px; }
  }

  @media screen and (max-width: 480px) {
    .frv__container { padding: 0 16px; }
    .frv__stars svg { width: 20px; height: 20px; }
    .frv__google-text { font-size: 20px; }
    .frv__nav--prev { left: -4px; }
    .frv__nav--next { right: -4px; }
    .frv__nav { width: 34px; height: 34px; }
  }
{% endstyle %}

{% assign review_blocks = section.blocks | where: 'type', 'review' %}

<section
  class="frv"
  id="frv-{{ section.id }}"
  style="
    --section-bg: {{ section.settings.section_bg }};
    --heading-color: {{ section.settings.heading_color }};
    --text-color: {{ section.settings.text_color }};
    --accent-color: {{ section.settings.accent_color }};
    --star-color: {{ section.settings.star_color }};
    --body-size: {{ section.settings.body_font_size }}px;
    --texture-opacity: {{ section.settings.texture_opacity | divided_by: 100.0 }};
    --padding-top: {{ section.settings.padding_top }}px;
    --padding-bottom: {{ section.settings.padding_bottom }}px;
  "
>
  {% if section.settings.show_texture %}<div class="frv__texture"></div>{% endif %}

  <div class="frv__container">
    <!-- Google header -->
    <div class="frv__header" data-frv-animate data-delay="0">
      <div class="frv__google-text">
        <span class="frv__google-g">
          <svg viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 01-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18A10.96 10.96 0 001 12c0 1.77.42 3.44 1.18 4.93l3.66-2.84z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>
        </span>
        Google
      </div>
      <div class="frv__stars">
        {% for i in (1..5) %}
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>
        {% endfor %}
      </div>
    </div>

    {% if review_blocks.size > 0 %}
      <div class="frv__slider" data-frv-animate data-delay="1">
        <div class="frv__slides" data-frv-slides>
          {% for block in review_blocks %}
            <div class="frv__slide{% if forloop.first %} is-active{% endif %}" data-frv-slide="{{ forloop.index0 }}" {{ block.shopify_attributes }}>
              <div class="frv__layout">
                <div class="frv__quote-wrap">
                  <span class="frv__quote-mark">"</span>
                  {% if block.settings.quote != blank %}
                    <div class="frv__quote-text">{{ block.settings.quote }}</div>
                  {% endif %}
                  {% if block.settings.author != blank %}
                    <p class="frv__author">{{ block.settings.author }}</p>
                  {% endif %}
                  <div class="frv__heart">â™¡</div>
                </div>

                {% if block.settings.image != blank %}
                  <div class="frv__image">
                    {{ block.settings.image | image_url: width: 700 | image_tag: loading: 'lazy', widths: '400,550,700' }}
                  </div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>

        {% if review_blocks.size > 1 %}
          <button class="frv__nav frv__nav--prev" data-frv-prev aria-label="Previous review">
            <svg viewBox="0 0 20 20" fill="none"><path d="M13 4L7 10L13 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <button class="frv__nav frv__nav--next" data-frv-next aria-label="Next review">
            <svg viewBox="0 0 20 20" fill="none"><path d="M7 4L13 10L7 16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>

          <div class="frv__dots">
            {% for block in review_blocks %}
              <button class="frv__dot{% if forloop.first %} is-active{% endif %}" data-frv-dot="{{ forloop.index0 }}" aria-label="Go to review {{ forloop.index }}"></button>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var sec = document.getElementById('frv-{{ section.id }}');
    if (!sec) return;

    var animEls = sec.querySelectorAll('[data-frv-animate]');
    var obs = new IntersectionObserver(function (entries) {
      entries.forEach(function (e) {
        if (e.isIntersecting) {
          var d = parseInt(e.target.getAttribute('data-delay') || '0', 10);
          setTimeout(function () { e.target.classList.add('is-visible'); }, d * 150);
          obs.unobserve(e.target);
        }
      });
    }, { threshold: 0.1 });
    animEls.forEach(function (el) { obs.observe(el); });

    var slides = sec.querySelectorAll('[data-frv-slide]');
    var dots = sec.querySelectorAll('[data-frv-dot]');
    var prevBtn = sec.querySelector('[data-frv-prev]');
    var nextBtn = sec.querySelector('[data-frv-next]');
    var total = slides.length;
    if (total <= 1) return;

    var current = 0;
    var isAnimating = false;
    var autoplayInterval = null;
    var autoplayDelay = {{ section.settings.autoplay_speed }};
    var autoplayEnabled = {{ section.settings.autoplay }};

    function goTo(idx) {
      if (isAnimating || idx === current) return;
      isAnimating = true;

      var oldSlide = slides[current];
      var newSlide = slides[idx];

      oldSlide.classList.remove('is-active');
      oldSlide.classList.add('is-exiting');

      newSlide.classList.add('is-active');

      dots.forEach(function (d) { d.classList.remove('is-active'); });
      if (dots[idx]) dots[idx].classList.add('is-active');

      setTimeout(function () {
        oldSlide.classList.remove('is-exiting');
        isAnimating = false;
      }, 520);

      current = idx;
    }

    function next() { goTo((current + 1) % total); }
    function prev() { goTo((current - 1 + total) % total); }

    if (prevBtn) prevBtn.addEventListener('click', function () { prev(); resetAutoplay(); });
    if (nextBtn) nextBtn.addEventListener('click', function () { next(); resetAutoplay(); });

    dots.forEach(function (dot) {
      dot.addEventListener('click', function () {
        goTo(parseInt(this.getAttribute('data-frv-dot'), 10));
        resetAutoplay();
      });
    });

    var startX = 0;
    var slidesEl = sec.querySelector('[data-frv-slides]');
    if (slidesEl) {
      slidesEl.addEventListener('touchstart', function (e) {
        startX = e.touches[0].clientX;
      }, { passive: true });
      slidesEl.addEventListener('touchend', function (e) {
        var diff = startX - e.changedTouches[0].clientX;
        if (Math.abs(diff) > 50) {
          if (diff > 0) { next(); } else { prev(); }
          resetAutoplay();
        }
      }, { passive: true });
    }

    function startAutoplay() {
      if (!autoplayEnabled || total <= 1) return;
      autoplayInterval = setInterval(next, autoplayDelay);
    }
    function resetAutoplay() {
      clearInterval(autoplayInterval);
      startAutoplay();
    }
    startAutoplay();

    sec.addEventListener('mouseenter', function () { clearInterval(autoplayInterval); });
    sec.addEventListener('mouseleave', function () { startAutoplay(); });
  });
</script>

{% schema %}
{
  "name": "Review Slider",
  "tag": "section",
  "class": "featured-review-section",
  "settings": [
    { "type": "header", "content": "Slider Settings" },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": true },
    { "type": "range", "id": "autoplay_speed", "label": "Autoplay Speed", "min": 3000, "max": 8000, "step": 500, "default": 6000, "unit": "ms" },
    { "type": "header", "content": "Background & Texture" },
    { "type": "color", "id": "section_bg", "label": "Section Background", "default": "#ece6df" },
    { "type": "checkbox", "id": "show_texture", "label": "Show Paper Texture", "default": true },
    { "type": "range", "id": "texture_opacity", "label": "Texture Intensity", "min": 0, "max": 100, "step": 5, "default": 80, "unit": "%" },
    { "type": "header", "content": "Colors" },
    { "type": "color", "id": "heading_color", "label": "Heading / Author Color", "default": "#3a3a3a" },
    { "type": "color", "id": "text_color", "label": "Quote Text Color", "default": "#555555" },
    { "type": "color", "id": "accent_color", "label": "Quote Mark / Heart Color", "default": "#c4a080" },
    { "type": "color", "id": "star_color", "label": "Star Color", "default": "#c8962e" },
    { "type": "header", "content": "Typography" },
    { "type": "range", "id": "body_font_size", "label": "Quote Font Size", "min": 14, "max": 22, "step": 1, "default": 17, "unit": "px" },
    { "type": "header", "content": "Layout" },
    { "type": "range", "id": "padding_top", "label": "Padding Top", "min": 0, "max": 120, "step": 4, "default": 72, "unit": "px" },
    { "type": "range", "id": "padding_bottom", "label": "Padding Bottom", "min": 0, "max": 120, "step": 4, "default": 72, "unit": "px" }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        { "type": "richtext", "id": "quote", "label": "Review Text", "default": "<p>I genuinely cannot recommend Laser Skin Clinics enough.</p><p>From the moment I arrived, I was greeted by the lovely Angel. Friendly, professional and very informative from the get go!</p>" },
        { "type": "text", "id": "author", "label": "Author", "default": "Thank you :) x" },
        { "type": "image_picker", "id": "image", "label": "Side Image" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Review Slider",
      "blocks": [
        { "type": "review", "settings": { "quote": "<p>I genuinely cannot recommend Laser Skin Clinics enough.</p><p>From the moment I arrived, I was greeted by the lovely Angel. Friendly, professional and very informative from the get go! Maxine who is the loveliest of ladies has performed my 3 x treatments to date. Each time she has been incredible.</p><p>Location is lovely. Facilities spotlessly clean. Prices I find are very reasonable. I would not go anywhere else.</p>", "author": "Thank you :) x" } },
        { "type": "review", "settings": { "quote": "<p>Absolutely amazing experience from start to finish. The staff are so welcoming and professional.</p><p>I had my first treatment and the results were incredible. I felt so comfortable throughout the whole process and the aftercare advice was really thorough.</p>", "author": "Sarah M." } },
        { "type": "review", "settings": { "quote": "<p>I was nervous about my first visit but the team put me completely at ease. They explained everything clearly and the results speak for themselves.</p><p>I've now had multiple sessions and each one has been just as good as the last. Highly recommend to anyone considering treatment.</p>", "author": "James K." } }
      ]
    }
  ]
}
{% endschema %}
