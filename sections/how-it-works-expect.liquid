{% comment %}
  How It Works & What to Expect Section
  - Main heading (dynamic with product title)
  - "How it works" sub-section with paragraph blocks
  - Timeline with 4 phases: dotted line + circle markers
  - Check items under each phase
  - Bottom note
  - Fully customizable from section settings
{% endcomment %}

<style>
  .hiw-section {
    max-width: {{ section.settings.section_width }}px;
    margin: 0 auto;
    padding: {{ section.settings.padding_top }}px {{ section.settings.padding_side }}px {{ section.settings.padding_bottom }}px;
    background: {{ section.settings.background_color }};
  }

  .hiw-inner {
    max-width: {{ section.settings.content_max_width }}px;
    margin: 0 auto;
  }

  /* Main Heading */
  .hiw-heading {
    font-size: {{ section.settings.heading_font_size }}px;
    font-weight: {{ section.settings.heading_font_weight }};
    color: {{ section.settings.heading_color }};
    margin: 0 0 32px 0;
    line-height: 1.3;
  }

  /* How It Works Sub-section */
  .hiw-subtitle {
    font-size: {{ section.settings.subtitle_font_size }}px;
    font-weight: {{ section.settings.subtitle_font_weight }};
    color: {{ section.settings.subtitle_color }};
    margin: 0 0 16px 0;
    line-height: 1.3;
  }

  .hiw-paragraph {
    font-size: {{ section.settings.paragraph_font_size }}px;
    color: {{ section.settings.paragraph_color }};
    line-height: 1.7;
    margin: 0 0 16px 0;
  }

  .hiw-paragraph:last-of-type {
    margin-bottom: 0;
  }

  .hiw-text-block {
    margin-bottom: 40px;
  }

  /* Timeline Grid */
  .hiw-timeline {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0;
    margin-bottom: 48px;
  }

  .hiw-phase {
    padding: 0 16px;
    position: relative;
  }

  .hiw-phase:first-child {
    padding-left: 0;
  }

  .hiw-phase:last-child {
    padding-right: 0;
  }

  /* Dividers between phases */
  .hiw-phase + .hiw-phase {
    border-left: 1px solid {{ section.settings.phase_divider_color }};
  }

  /* Phase Title */
  .hiw-phase-title {
    font-size: {{ section.settings.phase_title_font_size }}px;
    font-weight: {{ section.settings.phase_title_font_weight }};
    color: {{ section.settings.phase_title_color }};
    margin: 0 0 12px 0;
    line-height: 1.3;
  }

  /* Timeline Bar */
  .hiw-timeline-bar {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    height: 20px;
    position: relative;
  }

  .hiw-timeline-line {
    flex: 1;
    height: 0;
    border-top: 2px dotted {{ section.settings.timeline_line_color }};
  }

  .hiw-phase:first-child .hiw-timeline-line {
    border-top-style: solid;
  }

  .hiw-timeline-dot {
    width: {{ section.settings.timeline_dot_size }}px;
    height: {{ section.settings.timeline_dot_size }}px;
    border-radius: 50%;
    background: {{ section.settings.timeline_dot_color }};
    flex-shrink: 0;
  }

  /* Phase Items */
  .hiw-phase-item {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    margin-bottom: 14px;
  }

  .hiw-phase-item:last-child {
    margin-bottom: 0;
  }

  .hiw-phase-check {
    flex-shrink: 0;
    width: {{ section.settings.check_size }}px;
    height: {{ section.settings.check_size }}px;
    color: {{ section.settings.check_color }};
    margin-top: 2px;
  }

  .hiw-phase-text {
    font-size: {{ section.settings.item_font_size }}px;
    color: {{ section.settings.item_text_color }};
    line-height: 1.5;
  }

  /* Bottom Note */
  .hiw-note {
    text-align: center;
    font-size: {{ section.settings.note_font_size }}px;
    color: {{ section.settings.note_color }};
    font-style: {{ section.settings.note_font_style }};
    line-height: 1.6;
    max-width: 750px;
    margin: 0 auto;
    padding-top: 32px;
    border-top: 1px solid {{ section.settings.note_border_color }};
  }

  /* Responsive */
  @media screen and (max-width: 900px) {
    .hiw-timeline {
      grid-template-columns: repeat(2, 1fr);
      gap: 32px 0;
    }

    .hiw-phase {
      padding: 0 16px;
    }

    .hiw-phase:first-child {
      padding-left: 0;
    }

    .hiw-phase:nth-child(2) {
      padding-right: 0;
    }

    .hiw-phase:nth-child(3) {
      padding-left: 0;
      border-left: none;
    }

    .hiw-phase:nth-child(4) {
      padding-right: 0;
    }
  }

  @media screen and (max-width: 600px) {
    .hiw-section {
      padding: 40px 20px;
    }

    .hiw-timeline {
      grid-template-columns: 1fr;
      gap: 28px;
    }

    .hiw-phase {
      padding: 0 0 28px 0;
      border-left: none !important;
      border-bottom: 1px solid {{ section.settings.phase_divider_color }};
    }

    .hiw-phase:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }

    .hiw-heading {
      font-size: {{ section.settings.heading_font_size | times: 0.75 | round }}px;
    }
  }
</style>

<section class="hiw-section">
  <div class="hiw-inner">

    {% comment %} Main Heading {% endcomment %}
    {% if section.settings.heading != blank %}
      {%- liquid
        if product.title != blank
          assign heading_text = section.settings.heading | replace: '[treatment]', product.title
        else
          assign heading_text = section.settings.heading | replace: '[treatment]', section.settings.default_treatment_name
        endif
      -%}
      <h2 class="hiw-heading">{{ heading_text }}</h2>
    {% endif %}

    {% comment %} How It Works Text {% endcomment %}
    <div class="hiw-text-block">
      {% if section.settings.subtitle != blank %}
        <h3 class="hiw-subtitle">{{ section.settings.subtitle }}</h3>
      {% endif %}
      {% for block in section.blocks %}
        {% if block.type == 'paragraph' %}
          <p class="hiw-paragraph" {{ block.shopify_attributes }}>{{ block.settings.text }}</p>
        {% endif %}
      {% endfor %}
    </div>

    {% comment %} Timeline {% endcomment %}
    <div class="hiw-timeline">
      {% for block in section.blocks %}
        {% if block.type == 'phase' %}
          <div class="hiw-phase" {{ block.shopify_attributes }}>
            <h4 class="hiw-phase-title">{{ block.settings.title }}</h4>
            <div class="hiw-timeline-bar">
              <div class="hiw-timeline-line"></div>
              <div class="hiw-timeline-dot"></div>
            </div>
            {% assign items = block.settings.items | split: '|' %}
            {% for item in items %}
              {% assign item_clean = item | strip %}
              {% if item_clean != blank %}
                <div class="hiw-phase-item">
                  <svg class="hiw-phase-check" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span class="hiw-phase-text">{{ item_clean }}</span>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    {% comment %} Bottom Note {% endcomment %}
    {% if section.settings.bottom_note != blank %}
      <p class="hiw-note">{{ section.settings.bottom_note }}</p>
    {% endif %}

  </div>
</section>

{% schema %}
{
  "name": "How It Works & Expect",
  "tag": "section",
  "class": "hiw-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Section Layout"
    },
    {
      "type": "range",
      "id": "section_width",
      "label": "Section Width",
      "min": 800,
      "max": 1600,
      "step": 50,
      "default": 1400,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "content_max_width",
      "label": "Content Max Width",
      "min": 600,
      "max": 1200,
      "step": 50,
      "default": 1050,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Top Padding",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 60,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Bottom Padding",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 60,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_side",
      "label": "Side Padding",
      "min": 15,
      "max": 60,
      "step": 5,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f8ece8"
    },
    {
      "type": "header",
      "content": "Main Heading"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "How [treatment] Works & What to Expect",
      "info": "Use [treatment] to dynamically insert the product title."
    },
    {
      "type": "range",
      "id": "heading_font_size",
      "label": "Heading Font Size",
      "min": 24,
      "max": 48,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "heading_font_weight",
      "label": "Heading Font Weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" }
      ],
      "default": "400"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#3d1f1f"
    },
    {
      "type": "text",
      "id": "default_treatment_name",
      "label": "Default Treatment Name",
      "default": "This Treatment",
      "info": "Used on non-product pages"
    },
    {
      "type": "header",
      "content": "How It Works Text"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "How it works"
    },
    {
      "type": "range",
      "id": "subtitle_font_size",
      "label": "Subtitle Font Size",
      "min": 16,
      "max": 26,
      "step": 1,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "subtitle_font_weight",
      "label": "Subtitle Font Weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "600"
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Subtitle Color",
      "default": "#3d1f1f"
    },
    {
      "type": "range",
      "id": "paragraph_font_size",
      "label": "Paragraph Font Size",
      "min": 13,
      "max": 18,
      "step": 1,
      "default": 15,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "paragraph_color",
      "label": "Paragraph Color",
      "default": "#3d1f1f"
    },
    {
      "type": "header",
      "content": "Timeline"
    },
    {
      "type": "range",
      "id": "timeline_dot_size",
      "label": "Timeline Dot Size",
      "min": 10,
      "max": 24,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "timeline_dot_color",
      "label": "Timeline Dot Color",
      "default": "#b8a090"
    },
    {
      "type": "color",
      "id": "timeline_line_color",
      "label": "Timeline Line Color",
      "default": "#b8a090"
    },
    {
      "type": "color",
      "id": "phase_divider_color",
      "label": "Phase Divider Color",
      "default": "#d4b8b8"
    },
    {
      "type": "header",
      "content": "Phase Titles"
    },
    {
      "type": "range",
      "id": "phase_title_font_size",
      "label": "Phase Title Font Size",
      "min": 14,
      "max": 24,
      "step": 1,
      "default": 18,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "phase_title_font_weight",
      "label": "Phase Title Font Weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "600"
    },
    {
      "type": "color",
      "id": "phase_title_color",
      "label": "Phase Title Color",
      "default": "#3d1f1f"
    },
    {
      "type": "header",
      "content": "Check Items"
    },
    {
      "type": "range",
      "id": "check_size",
      "label": "Check Icon Size",
      "min": 16,
      "max": 28,
      "step": 1,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "check_color",
      "label": "Check Icon Color",
      "default": "#8a6060"
    },
    {
      "type": "range",
      "id": "item_font_size",
      "label": "Item Font Size",
      "min": 13,
      "max": 18,
      "step": 1,
      "default": 15,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "item_text_color",
      "label": "Item Text Color",
      "default": "#3d1f1f"
    },
    {
      "type": "header",
      "content": "Bottom Note"
    },
    {
      "type": "textarea",
      "id": "bottom_note",
      "label": "Bottom Note",
      "default": "Results develop gradually and are designed to look natural, not over-treated."
    },
    {
      "type": "range",
      "id": "note_font_size",
      "label": "Note Font Size",
      "min": 13,
      "max": 18,
      "step": 1,
      "default": 15,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "note_color",
      "label": "Note Color",
      "default": "#5a3a3a"
    },
    {
      "type": "select",
      "id": "note_font_style",
      "label": "Note Font Style",
      "options": [
        { "value": "normal", "label": "Normal" },
        { "value": "italic", "label": "Italic" }
      ],
      "default": "italic"
    },
    {
      "type": "color",
      "id": "note_border_color",
      "label": "Note Top Border Color",
      "default": "#d4a8a8"
    }
  ],
  "blocks": [
    {
      "type": "paragraph",
      "name": "How It Works Paragraph",
      "settings": [
        {
          "type": "textarea",
          "id": "text",
          "label": "Paragraph Text",
          "default": "Ultra-fine needles create controlled micro-channels in the skin while radio frequency energy is delivered beneath the surface."
        }
      ]
    },
    {
      "type": "phase",
      "name": "Timeline Phase",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Phase Title",
          "default": "Immediately after treatment"
        },
        {
          "type": "textarea",
          "id": "items",
          "label": "Phase Items",
          "default": "Skin may appear mildly red or warm|Sensation of tightness or sensitivity|Redness typically settles within 24–48 hours",
          "info": "Separate each item with a | character"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "How It Works & Expect",
      "blocks": [
        {
          "type": "paragraph",
          "settings": {
            "text": "Ultra-fine needles create controlled micro-channels in the skin while radio frequency energy is delivered beneath the surface."
          }
        },
        {
          "type": "paragraph",
          "settings": {
            "text": "This dual action stimulate collagen and elastin production, tightens skin from within, and improves overall skin quality over time."
          }
        },
        {
          "type": "paragraph",
          "settings": {
            "text": "The process strengthens skin structure and supports long-term regeneration rather than short-term tightening."
          }
        },
        {
          "type": "phase",
          "settings": {
            "title": "Immediately after treatment",
            "items": "Skin may appear mildly red or warm|Sensation of tightness or sensitivity|Redness typically settles within 24–48 hours"
          }
        },
        {
          "type": "phase",
          "settings": {
            "title": "Days 3–10",
            "items": "Skin begins early repair and renewal|Texture may feel smoother as healing progresses|Minor dryness or flaking can occur"
          }
        },
        {
          "type": "phase",
          "settings": {
            "title": "Weeks 3–6",
            "items": "Collagen production increases|Skin firmness and tone start to improve"
          }
        },
        {
          "type": "phase",
          "settings": {
            "title": "Weeks 8–12",
            "items": "Continued collagen remodelling|Visible improvements in firmness, clarity, and skin quality|Results look natural and progressive"
          }
        }
      ]
    }
  ]
}
{% endschema %}
