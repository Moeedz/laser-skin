{% comment %}
  Sticky Mobile Bottom Bar Section with Call & WhatsApp
  Save this file as: sections/sticky-mobile-bottom-bar.liquid
{% endcomment %}

<div class="sticky-mobile-bar">
  <a href="{{ section.settings.button_link }}" class="sticky-bar-button">
    {{ section.settings.button_text }}
  </a>
  
  <button type="button" class="sticky-bar-call" id="callButton" aria-label="Call us">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" fill="currentColor"/>
    </svg>
  </button>
  
  <a href="https://wa.me/{{ section.settings.whatsapp_number }}" 
     target="_blank" 
     class="sticky-bar-whatsapp"
     aria-label="Contact us on WhatsApp">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" fill="currentColor"/>
    </svg>
  </a>
</div>

<!-- Call Modal -->
<div class="call-modal-overlay" id="callModal">
  <div class="call-modal">
    <button type="button" class="call-modal-close" id="closeModal" aria-label="Close">×</button>
    
    <div class="call-modal-content">
      <div class="call-modal-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56a.977.977 0 00-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z" fill="currentColor"/>
        </svg>
      </div>
      
      <h3 class="call-modal-title">Call Us</h3>
      
      <div class="call-status" id="callStatus"></div>
      
      <div class="opening-hours">
        <h4>Opening Hours</h4>
        <div class="hours-list">
          {% if section.settings.monday_hours != blank %}
            <div class="hours-item">
              <span class="day">Monday</span>
              <span class="time">{{ section.settings.monday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.tuesday_hours != blank %}
            <div class="hours-item">
              <span class="day">Tuesday</span>
              <span class="time">{{ section.settings.tuesday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.wednesday_hours != blank %}
            <div class="hours-item">
              <span class="day">Wednesday</span>
              <span class="time">{{ section.settings.wednesday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.thursday_hours != blank %}
            <div class="hours-item">
              <span class="day">Thursday</span>
              <span class="time">{{ section.settings.thursday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.friday_hours != blank %}
            <div class="hours-item">
              <span class="day">Friday</span>
              <span class="time">{{ section.settings.friday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.saturday_hours != blank %}
            <div class="hours-item">
              <span class="day">Saturday</span>
              <span class="time">{{ section.settings.saturday_hours }}</span>
            </div>
          {% endif %}
          {% if section.settings.sunday_hours != blank %}
            <div class="hours-item">
              <span class="day">Sunday</span>
              <span class="time">{{ section.settings.sunday_hours }}</span>
            </div>
          {% endif %}
        </div>
      </div>
      
      <a href="tel:{{ section.settings.phone_number }}" class="call-now-btn" id="callNowBtn">
        Call Now
      </a>
    </div>
  </div>
</div>

<style>
  .sticky-mobile-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: none;
    background: white;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    z-index: 999;
    padding: 10px;
    gap: 10px;
  }

  @media (max-width: 768px) {
    .sticky-mobile-bar {
      display: flex;
    }
  }

  .sticky-bar-button {
    flex: 1;
    background: {{ section.settings.button_bg_color }};
    color: {{ section.settings.button_text_color }};
    text-decoration: none;
    padding: 15px 20px;
    border-radius: 4px;
    font-weight: 600;
    text-align: center;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: opacity 0.3s ease;
  }

  .sticky-bar-button:hover {
    opacity: 0.9;
  }

  .sticky-bar-call,
  .sticky-bar-whatsapp {
    background: {{ section.settings.call_bg_color }};
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px;
    border-radius: 4px;
    text-decoration: none;
    min-width: 54px;
    transition: opacity 0.3s ease;
    border: none;
    cursor: pointer;
  }

  .sticky-bar-whatsapp {
    background: {{ section.settings.whatsapp_bg_color }};
  }

  .sticky-bar-call:hover,
  .sticky-bar-whatsapp:hover {
    opacity: 0.9;
  }

  .sticky-bar-call svg,
  .sticky-bar-whatsapp svg {
    width: 24px;
    height: 24px;
  }

  /* Modal Styles */
  .call-modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .call-modal-overlay.active {
    display: flex;
  }

  .call-modal {
    background: white;
    border-radius: 12px;
    max-width: 400px;
    width: 100%;
    position: relative;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from {
      transform: translateY(50px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .call-modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: none;
    border: none;
    font-size: 30px;
    cursor: pointer;
    color: #666;
    line-height: 1;
    padding: 0;
    width: 30px;
    height: 30px;
  }

  .call-modal-content {
    padding: 30px;
    text-align: center;
  }

  .call-modal-icon {
    width: 80px;
    height: 80px;
    background: {{ section.settings.call_bg_color }};
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 20px;
    color: white;
  }

  .call-modal-title {
    font-size: 24px;
    margin: 0 0 15px;
    color: #333;
  }

  .call-status {
    padding: 12px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-weight: 600;
  }

  .call-status.open {
    background: #d4edda;
    color: #155724;
  }

  .call-status.closed {
    background: #f8d7da;
    color: #721c24;
  }

  .opening-hours {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    text-align: left;
  }

  .opening-hours h4 {
    margin: 0 0 15px;
    font-size: 16px;
    color: #333;
  }

  .hours-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .hours-item {
    display: flex;
    justify-content: space-between;
    font-size: 14px;
  }

  .hours-item .day {
    color: #666;
  }

  .hours-item .time {
    color: #333;
    font-weight: 600;
  }

  .call-now-btn {
    display: inline-block;
    background: {{ section.settings.call_bg_color }};
    color: white;
    padding: 15px 40px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    font-size: 16px;
    transition: opacity 0.3s ease;
  }

  .call-now-btn:hover {
    opacity: 0.9;
  }

  .call-now-btn.disabled {
    background: #ccc;
    cursor: not-allowed;
    pointer-events: none;
  }
</style>

<script>
  (function() {
    const callButton = document.getElementById('callButton');
    const callModal = document.getElementById('callModal');
    const closeModal = document.getElementById('closeModal');
    const callStatus = document.getElementById('callStatus');
    const callNowBtn = document.getElementById('callNowBtn');

    const openingHours = {
      1: '{{ section.settings.monday_hours }}',
      2: '{{ section.settings.tuesday_hours }}',
      3: '{{ section.settings.wednesday_hours }}',
      4: '{{ section.settings.thursday_hours }}',
      5: '{{ section.settings.friday_hours }}',
      6: '{{ section.settings.saturday_hours }}',
      0: '{{ section.settings.sunday_hours }}'
    };

    const timezone = '{{ section.settings.timezone }}' || 'UTC';

    function checkIfOpen() {
      try {
        const now = new Date().toLocaleString('en-US', { timeZone: timezone });
        const currentDate = new Date(now);
        const day = currentDate.getDay();
        const currentTime = currentDate.getHours() * 60 + currentDate.getMinutes();

        const todayHours = openingHours[day];

        if (!todayHours || todayHours === 'Closed') {
          return { isOpen: false, message: 'We are currently closed' };
        }

        const timeRanges = todayHours.split(',').map(t => t.trim());
        
        for (let range of timeRanges) {
          const [start, end] = range.split('-').map(t => t.trim());
          const startMinutes = parseTime(start);
          const endMinutes = parseTime(end);

          if (currentTime >= startMinutes && currentTime <= endMinutes) {
            return { isOpen: true, message: '✓ We are currently open' };
          }
        }

        return { isOpen: false, message: 'We are currently closed' };
      } catch (error) {
        console.error('Error checking opening hours:', error);
        return { isOpen: true, message: 'Call to check our hours' };
      }
    }

    function parseTime(timeStr) {
      const [time, period] = timeStr.split(/(?=[AP]M)/i);
      let [hours, minutes] = time.split(':').map(Number);
      
      if (period && period.toUpperCase() === 'PM' && hours !== 12) {
        hours += 12;
      } else if (period && period.toUpperCase() === 'AM' && hours === 12) {
        hours = 0;
      }
      
      return hours * 60 + (minutes || 0);
    }

    callButton.addEventListener('click', function() {
      const status = checkIfOpen();
      
      callStatus.textContent = status.message;
      callStatus.className = 'call-status ' + (status.isOpen ? 'open' : 'closed');
      
      if (!status.isOpen) {
        callNowBtn.classList.add('disabled');
        callNowBtn.textContent = 'Currently Closed';
      } else {
        callNowBtn.classList.remove('disabled');
        callNowBtn.textContent = 'Call Now';
      }
      
      callModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    });

    closeModal.addEventListener('click', function() {
      callModal.classList.remove('active');
      document.body.style.overflow = '';
    });

    callModal.addEventListener('click', function(e) {
      if (e.target === callModal) {
        callModal.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
  })();
</script>

{% schema %}
{
  "name": "Sticky Mobile Bottom Bar",
  "settings": [
    {
      "type": "header",
      "content": "Main Button Settings"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "BOOK FREE CONSULTATION"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background Color",
      "default": "#1a3a52"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Call Button Settings"
    },
    {
      "type": "text",
      "id": "phone_number",
      "label": "Phone Number",
      "info": "Enter your landline number",
      "default": "+441234567890"
    },
    {
      "type": "color",
      "id": "call_bg_color",
      "label": "Call Button Color",
      "default": "#0066cc"
    },
    {
      "type": "select",
      "id": "timezone",
      "label": "Timezone",
      "options": [
        { "value": "Europe/London", "label": "UK (London)" },
        { "value": "Europe/Paris", "label": "Europe (Paris)" },
        { "value": "America/New_York", "label": "US Eastern" },
        { "value": "America/Chicago", "label": "US Central" },
        { "value": "America/Denver", "label": "US Mountain" },
        { "value": "America/Los_Angeles", "label": "US Pacific" },
        { "value": "Asia/Dubai", "label": "UAE (Dubai)" },
        { "value": "Asia/Karachi", "label": "Pakistan (Karachi)" },
        { "value": "Asia/Kolkata", "label": "India (Delhi)" },
        { "value": "Asia/Singapore", "label": "Singapore" },
        { "value": "Australia/Sydney", "label": "Australia (Sydney)" }
      ],
      "default": "Europe/London"
    },
    {
      "type": "header",
      "content": "Opening Hours"
    },
    {
      "type": "text",
      "id": "monday_hours",
      "label": "Monday",
      "info": "Format: 9:00AM-5:00PM or 9:00AM-1:00PM, 2:00PM-6:00PM (use 'Closed' if closed)",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "tuesday_hours",
      "label": "Tuesday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "wednesday_hours",
      "label": "Wednesday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "thursday_hours",
      "label": "Thursday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "friday_hours",
      "label": "Friday",
      "default": "9:00AM-5:00PM"
    },
    {
      "type": "text",
      "id": "saturday_hours",
      "label": "Saturday",
      "default": "10:00AM-2:00PM"
    },
    {
      "type": "text",
      "id": "sunday_hours",
      "label": "Sunday",
      "default": "Closed"
    },
    {
      "type": "header",
      "content": "WhatsApp Settings"
    },
    {
      "type": "text",
      "id": "whatsapp_number",
      "label": "WhatsApp Number",
      "info": "Enter number with country code (e.g., 923001234567)",
      "default": "923001234567"
    },
    {
      "type": "color",
      "id": "whatsapp_bg_color",
      "label": "WhatsApp Button Color",
      "default": "#25D366"
    }
  ],
  "presets": [
    {
      "name": "Sticky Mobile Bottom Bar"
    }
  ]
}
{% endschema %}